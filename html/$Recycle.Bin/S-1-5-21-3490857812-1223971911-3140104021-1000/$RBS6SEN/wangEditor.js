(function(a){if(typeof window.define==="function"){if(window.define.amd){window.define("wangEditor",["jquery"],a)}else{if(window.define.cmd){window.define(function(c,b,d){return a})}else{a(window.jQuery)}}}else{if(typeof module==="object"&&typeof module.exports==="object"){window.wangEditorCssPath?require(window.wangEditorCssPath):require("../css/wangEditor.css");module.exports=a(window.wangEditorJQueryPath?require(window.wangEditorJQueryPath):require("jquery"))}else{a(window.jQuery)}}})(function(b){if(!b||!b.fn||!b.fn.jquery){alert("在引用wangEditor.js之前，先引用jQuery，否则无法使用 wangEditor");return}var a=function(c){var d=window.wangEditor;if(d){c(d,b)}};(function(c,e){if(c.wangEditor){alert("一个页面不能重复引用 wangEditor.js 或 wangEditor.min.js ！！！");return}var d=function(g){if(typeof g==="string"){g="#"+g}var f=e(g);if(f.length!==1){return}var h=f[0].nodeName;if(h!=="TEXTAREA"&&h!=="DIV"){return}this.valueNodeName=h.toLowerCase();this.$valueContainer=f;this.$prev=f.prev();this.$parent=f.parent();this.init()};d.fn=d.prototype;d.$body=e("body");d.$document=e(document);d.$window=e(c);d.userAgent=navigator.userAgent;d.getComputedStyle=c.getComputedStyle;d.w3cRange=typeof document.createRange==="function";d.hostname=location.hostname.toLowerCase();d.websiteHost="wangeditor.github.io|www.wangeditor.com|wangeditor.coding.me";d.isOnWebsite=d.websiteHost.indexOf(d.hostname)>=0;d.docsite="http://www.kancloud.cn/wangfupeng/wangeditor2/113961";c.wangEditor=d;d.plugin=function(f){if(!d._plugins){d._plugins=[]}if(typeof f==="function"){d._plugins.push(f)}}})(window,b);a(function(d,c){d.fn.init=function(){this.initDefaultConfig();this.addEditorContainer();this.addTxt();this.addMenuContainer();this.menus={};this.commandHooks()}});a(function(d,c){d.fn.ready=function(e){if(!this.readyFns){this.readyFns=[]}this.readyFns.push(e)};d.fn.readyHeadler=function(){var e=this.readyFns;while(e.length){e.shift().call(this)}};d.fn.updateValue=function(){var g=this;var e=g.$valueContainer;var f=g.txt.$txt;if(e===f){return}var h=f.html();e.val(h)};d.fn.getInitValue=function(){var g=this;var e=g.$valueContainer;var f="";var h=g.valueNodeName;if(h==="div"){f=e.html()}else{if(h==="textarea"){f=e.val()}}return f};d.fn.updateMenuStyle=function(){var e=this.menus;c.each(e,function(f,g){g.updateSelected()})};d.fn.enableMenusExcept=function(e){if(this._disabled){return}e=e||[];if(typeof e==="string"){e=[e]}c.each(this.menus,function(f,g){if(e.indexOf(f)>=0){return}g.disabled(false)})};d.fn.disableMenusExcept=function(e){if(this._disabled){return}e=e||[];if(typeof e==="string"){e=[e]}c.each(this.menus,function(f,g){if(e.indexOf(f)>=0){return}g.disabled(true)})};d.fn.hideDropPanelAndModal=function(){var e=this.menus;c.each(e,function(g,h){var f=h.dropPanel||h.dropList||h.modal;if(f&&f.hide){f.hide()}})}});a(function(f,e){var d=!f.w3cRange;function c(){}f.fn.currentRange=function(g){if(g){this._rangeData=g}else{return this._rangeData}};f.fn.collapseRange=function(g,h){h=h||"end";h=h==="start"?true:false;g=g||this.currentRange();if(g){g.collapse(h);this.currentRange(g)}};f.fn.getRangeText=d?c:function(g){g=g||this.currentRange();if(!g){return}return g.toString()};f.fn.getRangeElem=d?c:function(g){g=g||this.currentRange();var h=g.commonAncestorContainer;if(h.nodeType===1){return h}else{return h.parentNode}};f.fn.isRangeEmpty=d?c:function(g){g=g||this.currentRange();if(g&&g.startContainer){if(g.startContainer===g.endContainer){if(g.startOffset===g.endOffset){return true}}}return false};f.fn.saveSelection=d?c:function(i){var h=this,k,j,g=h.txt.$txt.get(0);if(i){k=i.commonAncestorContainer}else{j=document.getSelection();if(j.getRangeAt&&j.rangeCount){i=document.getSelection().getRangeAt(0);k=i.commonAncestorContainer}}if(k&&(e.contains(g,k)||g===k)){h.currentRange(i)}};f.fn.restoreSelection=d?c:function(g){var i;g=g||this.currentRange();if(!g){return}try{i=document.getSelection();i.removeAllRanges();i.addRange(g)}catch(h){f.error("执行 editor.restoreSelection 时，IE可能会有异常，不影响使用")}};f.fn.restoreSelectionByElem=d?c:function(h,g){if(!h){return}g=g||"end";this.setRangeByElem(h);if(g==="start"){this.collapseRange(this.currentRange(),"start")}if(g==="end"){this.collapseRange(this.currentRange(),"end")}this.restoreSelection()};f.fn.initSelection=d?c:function(){var i=this;if(i.currentRange()){return}var h;var g=i.txt.$txt;var j=g.children().first();if(j.length){i.restoreSelectionByElem(j.get(0))}};f.fn.setRangeByElem=d?c:function(k){var j=this;var l=j.txt.$txt.get(0);if(!k||!e.contains(l,k)){return}var i=k.firstChild;while(i){if(i.nodeType===3){break}i=i.firstChild}var g=k.lastChild;while(g){if(g.nodeType===3){break}g=g.lastChild}var h=document.createRange();if(i&&g){h.setStart(i,0);h.setEnd(g,g.textContent.length)}else{h.setStart(k,0);h.setEnd(k,0)}j.saveSelection(h)}});a(function(d,c){if(d.w3cRange){return}d.fn.getRangeText=function(e){e=e||this.currentRange();if(!e){return}return e.text};d.fn.getRangeElem=function(e){e=e||this.currentRange();if(!e){return}var f=e.parentElement();if(f.nodeType===1){return f}else{return f.parentNode}};d.fn.isRangeEmpty=function(e){e=e||this.currentRange();if(e&&e.text){return false}return true};d.fn.saveSelection=function(g){var f=this,i,h,e=f.txt.$txt.get(0);if(g){i=g.parentElement()}else{g=document.selection.createRange();if(typeof g.parentElement==="undefined"){i=null}else{i=g.parentElement()}}if(i&&(c.contains(e,i)||e===i)){f.currentRange(g)}};d.fn.restoreSelection=function(e){var i=this,h,f;e=e||i.currentRange();if(!e){return}f=document.selection.createRange();try{f.setEndPoint("EndToEnd",e)}catch(g){}if(e.text.length===0){try{f.collapse(false)}catch(g){}}else{f.setEndPoint("StartToStart",e)}f.select()}});a(function(d,c){d.fn.commandHooks=function(){var f=this;var e={};e.insertHtml=function(i){var h=c(i);var g=f.getRangeElem();var j;j=f.getLegalTags(g);if(!j){return}c(j).after(h)};f.commandHooks=e}});a(function(d,c){d.fn.command=function(k,h,g,l){var i=this;var f;function j(){if(!h){return}if(i.queryCommandSupported(h)){document.execCommand(h,false,g)}else{f=i.commandHooks;if(h in f){f[h](g)}}}this.customCommand(k,j,l)};d.fn.commandForElem=function(l,k,j,i,m){var g;var h;if(typeof l==="string"){g=l}else{g=l.selector;h=l.check}var f=this.getRangeElem();f=this.getSelfOrParentByName(f,g,h);if(f){this.setRangeByElem(f)}this.command(k,j,i,m)};d.fn.customCommand=function(j,i,k){var h=this;var g=h.currentRange();if(!g){j&&j.preventDefault();return}h.undoRecord();this.restoreSelection(g);i.call(h);this.saveSelection();this.restoreSelection();if(k&&typeof k==="function"){k.call(h)}h.txt.insertEmptyP();h.txt.wrapImgAndText();h.updateValue();h.updateMenuStyle();function f(){h.hideDropPanelAndModal()}setTimeout(f,200);if(j){j.preventDefault()}};d.fn.queryCommandValue=function(g){var e="";try{e=document.queryCommandValue(g)}catch(f){}return e};d.fn.queryCommandState=function(g){var e=false;try{e=document.queryCommandState(g)}catch(f){}return e};d.fn.queryCommandSupported=function(g){var e=false;try{e=document.queryCommandSupported(g)}catch(f){}return e}});a(function(e,d){var c;function f(h){var i=this;var j=d(h);var g=false;j.each(function(){if(this===i){g=true;return false}});return g}e.fn.getLegalTags=function(h){var g=this.config.legalTags;if(!g){e.error("配置项中缺少 legalTags 的配置");return}return this.getSelfOrParentByName(h,g)};e.fn.getSelfOrParentByName=function(j,h,i){if(!j||!h){return}if(!c){c=j.webkitMatchesSelector||j.mozMatchesSelector||j.oMatchesSelector||j.matchesSelector}if(!c){c=f}var g=this.txt.$txt.get(0);while(j&&g!==j&&d.contains(g,j)){if(c.call(j,h)){if(!i){return j}if(i(j)){return j}}j=j.parentNode}return}});a(function(h,g){var f=20;function d(i){if(i._redoList==null){i._redoList=[]}return i._redoList}function e(i){if(i._undoList==null){i._undoList=[]}return i._undoList}function c(k,l,j){var m=l.val;var i=k.txt.$txt.html();if(m==null){return}if(m===i){if(j==="redo"){k.redo();return}else{if(j==="undo"){k.undo();return}else{return}}}k.txt.$txt.html(m);k.updateValue();if(k.onchange&&typeof k.onchange==="function"){k.onchange.call(k)}}h.fn.undoRecord=function(){var m=this;var k=m.txt.$txt;var n=k.html();var j=e(m);var i=d(m);var l=j.length?j[0]:"";if(n===l.val){return}if(i.length){i=[]}j.unshift({range:m.currentRange(),val:n});if(j.length>f){j.pop()}};h.fn.undo=function(){var k=this;var j=e(k);var i=d(k);if(!j.length){return}var l=j.shift();i.unshift(l);c(this,l,"undo")};h.fn.redo=function(){var k=this;var j=e(k);var i=d(k);if(!i.length){return}var l=i.shift();j.unshift(l);c(this,l,"redo")}});a(function(d,c){d.fn.create=function(){var e=this;if(!d.$body||d.$body.length===0){d.$body=c("body");d.$document=c(document);d.$window=c(window)}e.addMenus();e.renderMenus();e.renderMenuContainer();e.renderTxt();e.renderEditorContainer();e.eventMenus();e.eventMenuContainer();e.eventTxt();e.readyHeadler();e.initSelection();e.$txt=e.txt.$txt;var f=d._plugins;if(f&&f.length){c.each(f,function(g,h){h.call(e)})}};d.fn.disable=function(){this.txt.$txt.removeAttr("contenteditable");this.disableMenusExcept();this._disabled=true};d.fn.enable=function(){this._disabled=false;this.txt.$txt.attr("contenteditable","true");this.enableMenusExcept()};d.fn.destroy=function(){var f=this;var e=f.$valueContainer;var h=f.$editorContainer;var g=f.valueNodeName;if(g==="div"){e.removeAttr("contenteditable");h.after(e);h.hide()}else{e.show();h.hide()}};d.fn.undestroy=function(){var g=this;var f=g.$valueContainer;var i=g.$editorContainer;var e=g.menuContainer.$menuContainer;var h=g.valueNodeName;if(h==="div"){f.attr("contenteditable","true");e.after(f);i.show()}else{f.hide();i.show()}};d.fn.clear=function(){var f=this;var e=f.txt.$txt;e.html("<p><br></p>");f.restoreSelectionByElem(e.find("p").get(0))}});a(function(e,d){var c=function(f){this.editor=f;this.init()};c.fn=c.prototype;e.MenuContainer=c});a(function(e,d){var c=e.MenuContainer;c.fn.init=function(){var g=this;var f=d('<div class="wangEditor-menu-container clearfix"></div>');g.$menuContainer=f;g.changeShadow()};c.fn.changeShadow=function(){var f=this.$menuContainer;var h=this.editor;var g=h.txt.$txt;g.on("scroll",function(){if(g.scrollTop()>10){f.addClass("wangEditor-menu-shadow")}else{f.removeClass("wangEditor-menu-shadow")}})}});a(function(e,d){var c=e.MenuContainer;c.fn.render=function(){var f=this.$menuContainer;var g=this.editor.$editorContainer;g.append(f)};c.fn.height=function(){var f=this.$menuContainer;return f.height()};c.fn.appendMenu=function(g,f){this._addGroup(g);return this._addOneMenu(f)};c.fn._addGroup=function(h){var f=this.$menuContainer;var g;if(!this.$currentGroup||this.currentGroupIdx!==h){g=d('<div class="menu-group clearfix"></div>');f.append(g);this.$currentGroup=g;this.currentGroupIdx=h}};c.fn._addOneMenu=function(i){var h=i.$domNormal;var j=i.$domSelected;var g=this.$currentGroup;var f=d('<div class="menu-item clearfix"></div>');j.hide();f.append(h).append(j);g.append(f);return f}});a(function(e,d){var c=function(f){this.editor=f.editor;this.id=f.id;this.title=f.title;this.$domNormal=f.$domNormal;this.$domSelected=f.$domSelected||f.$domNormal;this.commandName=f.commandName;this.commandValue=f.commandValue;this.commandNameSelected=f.commandNameSelected||f.commandName;this.commandValueSelected=f.commandValueSelected||f.commandValue};c.fn=c.prototype;e.Menu=c});a(function(e,d){var c=e.Menu;c.fn.initUI=function(){var g=this.editor;var f=g.UI.menus;var i=this.id;var h=f[i];if(this.$domNormal&&this.$domSelected){return}if(h==null){e.warn('editor.UI配置中，没有菜单 "'+i+'" 的UI配置，只能取默认值');h=f["default"]}this.$domNormal=d(h.normal);if(/^\./.test(h.selected)){this.$domSelected=this.$domNormal.clone().addClass(h.selected.slice(1))}else{this.$domSelected=d(h.selected)}}});a(function(e,d){var c=e.Menu;c.fn.render=function(j){this.initUI();var g=this.editor;var h=g.menuContainer;var f=h.appendMenu(j,this);var i=this.onRender;this._renderTip(f);if(i&&typeof i==="function"){i.call(this)}};c.fn._renderTip=function(i){var n=this;var h=n.editor;var j=n.title;var f=d('<div class="menu-tip"></div>');var m;if(!n.tipWidth){m=d('<p style="opacity:0; filter:Alpha(opacity=0); position:absolute;top:-10000px;">'+j+"</p>");e.$body.append(m);h.ready(function(){var p=this;var r=m.outerWidth()+5;var o=f.outerWidth();var q=parseFloat(f.css("margin-left"),10);m.remove();m=null;f.css({width:r,"margin-left":q+(o-r)/2});n.tipWidth=r})}f.append(j);i.append(f);function k(){f.show()}function g(){f.hide()}var l;i.find("a").on("mouseenter",function(o){if(!n.active()&&!n.disabled()){l=setTimeout(k,200)}}).on("mouseleave",function(o){l&&clearTimeout(l);g()}).on("click",g)};c.fn.bindEvent=function(){var i=this;var h=i.$domNormal;var j=i.$domSelected;var g=i.clickEvent;if(!g){g=function(o){var p=i.dropPanel||i.dropList||i.modal;if(p&&p.show){if(p.isShowing){p.hide()}else{p.show()}return}var n=i.editor;var l;var k;var m=i.selected;if(m){l=i.commandNameSelected;k=i.commandValueSelected}else{l=i.commandName;k=i.commandValue}if(l){n.command(o,l,k)}else{e.warn('菜单 "'+i.id+'" 未定义click事件');o.preventDefault()}}}var f=i.clickEventSelected||g;h.click(function(k){if(!i.disabled()){g.call(i,k);i.updateSelected()}k.preventDefault()});j.click(function(k){if(!i.disabled()){f.call(i,k);i.updateSelected()}k.preventDefault()})};c.fn.updateSelected=function(){var g=this;var h=g.editor;var i=g.updateSelectedEvent;if(!i){i=function(){var k=this;var m=k.editor;var l=k.commandName;var j=k.commandValue;if(j){if(m.queryCommandValue(l).toLowerCase()===j.toLowerCase()){return true}}else{if(m.queryCommandState(l)){return true}}return false}}var f=i.call(g);f=!!f;g.changeSelectedState(f)};c.fn.changeSelectedState=function(h){var f=this;var g=f.selected;if(h!=null&&typeof h==="boolean"){if(g===h){return}f.selected=h;if(h){f.$domNormal.hide();f.$domSelected.show()}else{f.$domNormal.show();f.$domSelected.hide()}}};c.fn.active=function(f){if(f==null){return this._activeState}this._activeState=f};c.fn.activeStyle=function(h){var g=this.selected;var f=this.$domNormal;var i=this.$domSelected;if(h){f.addClass("active");i.addClass("active")}else{f.removeClass("active");i.removeClass("active")}this.active(h)};c.fn.disabled=function(g){if(g==null){return !!this._disabled}if(this._disabled===g){return}var f=this.$domNormal;var h=this.$domSelected;if(g){f.addClass("disable");h.addClass("disable")}else{f.removeClass("disable");h.removeClass("disable")}this._disabled=g}});a(function(e,d){var c=function(g,h,f){this.editor=g;this.menu=h;this.data=f.data;this.tpl=f.tpl;this.selectorForELemCommand=f.selectorForELemCommand;this.beforeEvent=f.beforeEvent;this.afterEvent=f.afterEvent;this.init()};c.fn=c.prototype;e.DropList=c});a(function(e,d){var c=e.DropList;c.fn.init=function(){var f=this;f.initDOM();f.bindEvent();f.initHideEvent()};c.fn.initDOM=function(){var g=this;var j=g.data;var i=g.tpl||"<span>{#title}</span>";var h=d('<div class="wangEditor-drop-list clearfix"></div>');var k;var f;d.each(j,function(l,m){k=i.replace(/{#commandValue}/ig,l).replace(/{#title}/ig,m);f=d('<a href="#" commandValue="'+l+'"></a>');f.append(k);h.append(f)});g.$list=h};c.fn.bindEvent=function(){var f=this;var k=f.editor;var m=f.menu;var j=m.commandName;var h=f.selectorForELemCommand;var g=f.$list;var i=f.beforeEvent;var l=f.afterEvent;g.on("click","a[commandValue]",function(o){if(i&&typeof i==="function"){i.call(o)}var n=d(o.currentTarget).attr("commandValue");if(m.selected&&k.isRangeEmpty()&&h){k.commandForElem(h,o,j,n)}else{k.command(o,j,n)}if(l&&typeof l==="function"){l.call(o)}})};c.fn.initHideEvent=function(){var f=this;var g=f.$list.get(0);e.$body.on("click",function(j){if(!f.isShowing){return}var h=j.target;var k=f.menu;var i;if(k.selected){i=k.$domSelected.get(0)}else{i=k.$domNormal.get(0)}if(i===h||d.contains(i,h)){return}if(g===h||d.contains(g,h)){return}f.hide()});e.$window.scroll(function(){f.hide()});e.$window.on("resize",function(){f.hide()})}});a(function(e,d){var c=e.DropList;c.fn._render=function(){var f=this;var h=f.editor;var g=f.$list;h.$editorContainer.append(g);f.rendered=true};c.fn._position=function(){var v=this;var l=v.$list;var n=v.editor;var f=v.menu;var g=n.menuContainer.$menuContainer;var t=f.selected?f.$domSelected:f.$domNormal;var u=t.offsetParent().position();var s=u.top;var k=u.left;var h=t.offsetParent().height();var m=t.offsetParent().width();var q=l.outerWidth();var r=n.txt.$txt.outerWidth();var p=s+h;var i=k+m/2;var j=0-m/2;var o=(i+q)-r;if(o>-10){j=j-o-10}l.css({top:p,left:i,"margin-left":j});if(n._isMenufixed){p=p+((g.offset().top+g.outerHeight())-l.offset().top);l.css({top:p})}};c.fn.show=function(){var f=this;var h=f.menu;if(!f.rendered){f._render()}if(f.isShowing){return}var g=f.$list;g.show();f._position();f.isShowing=true;h.activeStyle(true)};c.fn.hide=function(){var f=this;var h=f.menu;if(!f.isShowing){return}var g=f.$list;g.hide();f.isShowing=false;h.activeStyle(false)}});a(function(e,d){var c=function(g,h,f){this.editor=g;this.menu=h;this.$content=f.$content;this.width=f.width||200;this.height=f.height;this.onRender=f.onRender;this.init()};c.fn=c.prototype;e.DropPanel=c});a(function(e,d){var c=e.DropPanel;c.fn.init=function(){var f=this;f.initDOM();f.initHideEvent()};c.fn.initDOM=function(){var g=this;var h=g.$content;var i=g.width;var f=g.height;var k=d('<div class="wangEditor-drop-panel clearfix"></div>');var j=d('<div class="tip-triangle"></div>');k.css({width:i,height:f?f:"auto"});k.append(j);k.append(h);g.$panel=k;g.$triangle=j};c.fn.initHideEvent=function(){var f=this;var g=f.$panel.get(0);e.$body.on("click",function(j){if(!f.isShowing){return}var h=j.target;var k=f.menu;var i;if(k.selected){i=k.$domSelected.get(0)}else{i=k.$domNormal.get(0)}if(i===h||d.contains(i,h)){return}if(g===h||d.contains(g,h)){return}f.hide()});e.$window.scroll(function(h){f.hide()});e.$window.on("resize",function(){f.hide()})}});a(function(e,d){var c=e.DropPanel;c.fn._render=function(){var f=this;var h=f.onRender;var g=f.editor;var i=f.$panel;g.$editorContainer.append(i);h&&h.call(f);f.rendered=true};c.fn._position=function(){var r=this;var k=r.$panel;var j=r.$triangle;var l=r.editor;var w=l.menuContainer.$menuContainer;var i=r.menu;var t=i.selected?i.$domSelected:i.$domNormal;var o=t.offsetParent().position();var x=o.top;var p=o.left;var s=t.offsetParent().height();var g=t.offsetParent().width();var h=k.outerWidth();var n=l.txt.$txt.outerWidth();var q=x+s;var m=p+g/2;var u=0-h/2;var v=u;if((0-u)>(m-10)){u=0-(m-10)}var f=(m+h+u)-n;if(f>-10){u=u-f-10}k.css({top:q,left:m,"margin-left":u});if(l._isMenufixed){q=q+((w.offset().top+w.outerHeight())-k.offset().top);k.css({top:q})}j.css({"margin-left":v-u-5})};c.fn.focusFirstInput=function(){var f=this;var g=f.$panel;g.find("input[type=text],textarea").each(function(){var h=d(this);if(h.attr("disabled")==null){h.focus();return false}})};c.fn.show=function(){var f=this;var h=f.menu;if(!f.rendered){f._render()}if(f.isShowing){return}var g=f.$panel;g.show();f._position();f.isShowing=true;h.activeStyle(true);if(e.w3cRange){f.focusFirstInput()}else{e.placeholderForIE8(g)}};c.fn.hide=function(){var f=this;var h=f.menu;if(!f.isShowing){return}var g=f.$panel;g.hide();f.isShowing=false;h.activeStyle(false)}});a(function(e,d){var c=function(g,h,f){this.editor=g;this.menu=h;this.$content=f.$content;this.init()};c.fn=c.prototype;e.Modal=c});a(function(e,d){var c=e.Modal;c.fn.init=function(){var f=this;f.initDom();f.initHideEvent()};c.fn.initDom=function(){var f=this;var h=f.$content;var g=d('<div class="wangEditor-modal"></div>');var i=d('<div class="wangEditor-modal-close"><i class="wangeditor-menu-img-cancel-circle"></i></div>');g.append(i);g.append(h);f.$modal=g;f.$close=i};c.fn.initHideEvent=function(){var f=this;var h=f.$close;var g=f.$modal.get(0);h.click(function(){f.hide()});e.$body.on("click",function(k){if(!f.isShowing){return}var i=k.target;var l=f.menu;var j;if(l){if(l.selected){j=l.$domSelected.get(0)}else{j=l.$domNormal.get(0)}if(j===i||d.contains(j,i)){return}}if(g===i||d.contains(g,i)){return}f.hide()})}});a(function(e,d){var c=e.Modal;c.fn._render=function(){var f=this;var h=f.editor;var g=f.$modal;g.css("z-index",h.config.zindex+10+"");e.$body.append(g);f.rendered=true};c.fn._position=function(){var h=this;var i=h.$modal;var m=i.offset().top;var j=i.outerWidth();var g=i.outerHeight();var l=0-(j/2);var k=0-(g/2);var f=e.$window.scrollTop();if((g/2)>m){k=0-m}i.css({"margin-left":l+"px","margin-top":(k+f)+"px"})};c.fn.show=function(){var f=this;var h=f.menu;if(!f.rendered){f._render()}if(f.isShowing){return}f.isShowing=true;var g=f.$modal;g.show();f._position();h&&h.activeStyle(true)};c.fn.hide=function(){var f=this;var h=f.menu;if(!f.isShowing){return}f.isShowing=false;var g=f.$modal;g.hide();h&&h.activeStyle(false)}});a(function(e,d){var c=function(f){this.editor=f;this.init()};c.fn=c.prototype;e.Txt=c});a(function(e,d){var c=e.Txt;c.fn.init=function(){var h=this;var j=h.editor;var f=j.$valueContainer;var i=j.getInitValue();var g;if(f.get(0).nodeName==="DIV"){g=f;g.addClass("wangEditor-txt");g.attr("contentEditable","true")}else{g=d('<div class="wangEditor-txt" contentEditable="true">'+i+"</div>")}j.ready(function(){h.insertEmptyP()});h.$txt=g;h.contentEmptyHandle();h.bindEnterForDiv();h.bindEnterForText();h.bindTabEvent();h.bindPasteFilter();h.bindFormatText();h.bindHtml()};c.fn.contentEmptyHandle=function(){var g=this;var i=g.editor;var f=g.$txt;var h;f.on("keydown",function(k){if(k.keyCode!==8){return}var j=d.trim(f.html().toLowerCase());if(j==="<p><br></p>"){k.preventDefault();return}});f.on("keyup",function(k){if(k.keyCode!==8){return}var j=d.trim(f.html().toLowerCase());if(!j||j==="<br>"){h=d("<p><br/></p>");f.html("");f.append(h);i.restoreSelectionByElem(h.get(0))}})};c.fn.bindEnterForDiv=function(){var i=e.config.legalTags;var h=this;var j=h.editor;var g=h.$txt;var k;function f(){if(!k){return}var l=d("<p>"+k.html()+"</p>");k.after(l);k.remove()}g.on("keydown keyup",function(p){if(p.keyCode!==13){return}var l=j.getRangeElem();var o=j.getLegalTags(l);var n;var m;if(!o){o=j.getSelfOrParentByName(l,"div");if(!o){return}n=d(o);if(p.type==="keydown"){k=n;setTimeout(f,0)}if(p.type==="keyup"){m=d("<p>"+n.html()+"</p>");n.after(m);n.remove();j.restoreSelectionByElem(m.get(0),"start")}}})};c.fn.bindEnterForText=function(){var g=this;var f=g.$txt;var h;f.on("keyup",function(i){if(i.keyCode!==13){return}if(!h){h=function(){g.wrapImgAndText()}}setTimeout(h)})};c.fn.bindTabEvent=function(){var g=this;var h=g.editor;var f=g.$txt;f.on("keydown",function(i){if(i.keyCode!==9){return}if(h.queryCommandSupported("insertHtml")){h.command(i,"insertHtml","&nbsp;&nbsp;&nbsp;&nbsp;")}})};c.fn.bindPasteFilter=function(){var m=this;var l=m.editor;var h="";var g=m.$txt;var f=l.config.legalTags;var n=f.split(",");g.on("paste",function(t){if(!l.config.pasteFilter){return}var r=l.getRangeElem().nodeName;if(r==="TD"||r==="TH"){return}h="";var p,q;var s=t.clipboardData||t.originalEvent.clipboardData;var o=window.clipboardData;if(l.config.pasteText){if(s&&s.getData){p=s.getData("text/plain")}else{if(o&&o.getData){p=o.getData("text")}else{return}}if(p){h="<p>"+p+"</p>"}}else{if(s&&s.getData){p=s.getData("text/html");if(p){q=d("<div>"+p+"</div>");k(q.get(0))}else{p=s.getData("text/plain");if(p){p=p.replace(/[ ]/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"</p><p>");h="<p>"+p+"</p>";h=h.replace(/<p>(https?:\/\/.*?)<\/p>/ig,function(u,v){return'<p><a href="'+v+'" target="_blank">'+v+"</p>"})}}}else{if(o&&o.getData){h=o.getData("text");if(!h){return}h="<p>"+h+"</p>";h=h.replace(new RegExp("\n","g"),"</p><p>")}else{return}}}if(h){l.command(t,"insertHtml",h);m.clearEmptyOrNestP()}});function k(q){if(!q||!q.nodeType||!q.nodeName){return}var p;var r=q.nodeName.toLowerCase();var o=q.nodeType;if(o!==3&&o!==1){return}p=d(q);if(r==="div"){d.each(q.childNodes,function(){k(this)});return}if(n.indexOf(r)>=0){h+=j(q)}else{if(o===3){h+="<p>"+q.textContent+"</p>"}else{if(r==="br"){h+="<br/>"}else{if(["meta","style","script","object","form","iframe","hr"].indexOf(r)>=0){return}p=d(i(q));h+=d("<div>").append(p.clone()).html()}}}}function j(q){var s=q.nodeName.toLowerCase();var o;var p="";var r="";if(["blockquote"].indexOf(s)>=0){o=d(q);return"<"+s+">"+o.text()+"</"+s+">"}else{if(["p","h1","h2","h3","h4","h5"].indexOf(s)>=0){q=i(q);o=d(q);p=o.html();p=p.replace(/<.*?>/ig,function(t){if(t==="</a>"||t.indexOf("<a ")===0||t.indexOf("<img ")===0){return t}else{return""}});return"<"+s+">"+p+"</"+s+">"}else{if(["ul","ol"].indexOf(s)>=0){o=d(q);o.children().each(function(){var u=d(i(this));var t=u.html();t=t.replace(/<.*?>/ig,function(v){if(v==="</a>"||v.indexOf("<a ")===0||v.indexOf("<img ")===0){return v}else{return""}});r+="<li>"+t+"</li>"});return"<"+s+">"+r+"</"+s+">"}else{o=d(i(q));return d("<div>").append(o).html()}}}}function i(r){var o=r.attributes||[];var s=[];var q=["href","target","src","alt","rowspan","colspan"];d.each(o,function(u,t){if(t&&t.nodeType===2){s.push(t.nodeName)}});d.each(s,function(u,t){if(q.indexOf(t)<0){r.removeAttribute(t)}});var p=r.childNodes;if(p.length){d.each(p,function(t,u){i(u)})}return r}};c.fn.bindFormatText=function(){var h=this;var k=h.editor;var g=h.$txt;var j=e.config.legalTags;var f=j.split(",");var l=f.length;var i=[];d.each(f,function(n,m){var o=">\\s*<("+m+")>";i.push(new RegExp(o,"ig"))});i.push(new RegExp(">\\s*<(li)>","ig"));i.push(new RegExp(">\\s*<(tr)>","ig"));i.push(new RegExp(">\\s*<(code)>","ig"));g.formatText=function(){var n=d("<div>");var m=g.html();m=m.replace(/\s*</ig,"<");d.each(i,function(o,p){if(!p.test(m)){return}m=m.replace(p,function(r,q){return">\n<"+q+">"})});n.html(m);return n.text()}};c.fn.bindHtml=function(){var h=this;var i=h.editor;var g=h.$txt;var f=i.$valueContainer;var j=i.valueNodeName;g.html=function(l){var k;if(j==="div"){k=d.fn.html.call(g,l)}if(l===undefined){k=d.fn.html.call(g);k=k.replace(/(href|src)\=\"(.*)\"/igm,function(n,m,o){return m+'="'+o.replace("&amp;","&")+'"'})}else{k=d.fn.html.call(g,l);f.val(l)}if(l===undefined){return k}else{g.change()}}}});a(function(f,e){var d=f.Txt;var c="propertychange change click keyup input paste";d.fn.render=function(){var g=this.$txt;var h=this.editor.$editorContainer;h.append(g)};d.fn.initHeight=function(){var j=this.editor;var g=this.$txt;var i=j.$valueContainer.height();var k=j.menuContainer.height();var h=i-k;h=h<50?50:h;g.height(h);j.valueContainerHeight=i;this.initMaxHeight(h,k)};d.fn.initMaxHeight=function(j,m){var k=this.editor;var g=k.menuContainer.$menuContainer;var i=this.$txt;var h=e("<div>");if(window.getComputedStyle&&"max-height" in window.getComputedStyle(i.get(0))){var l=parseInt(k.$valueContainer.css("max-height"));if(isNaN(l)){return}if(k.menus.fullscreen){f.warn("max-height和『全屏』菜单一起使用时，会有一些问题尚未解决，请暂时不要两个同时使用");return}k.useMaxHeight=true;h.css({"max-height":(l-m)+"px","overflow-y":"auto"});i.css({height:"auto","overflow-y":"visible","min-height":j+"px"});h.on("scroll",function(){if(i.parent().scrollTop()>10){g.addClass("wangEditor-menu-shadow")}else{g.removeClass("wangEditor-menu-shadow")}});i.wrap(h)}};d.fn.saveSelectionEvent=function(){var g=this.$txt;var h=this.editor;var l;var j=Date.now();function i(){h.saveSelection()}function m(){if(Date.now()-j<100){return}j=Date.now();i()}function k(){if(l){clearTimeout(l)}l=setTimeout(i,300)}g.on(c+" focus blur",function(n){m();k()});g.on("mousedown",function(){g.on("mouseleave.saveSelection",function(n){m();k();h.updateMenuStyle()})}).on("mouseup",function(){g.off("mouseleave.saveSelection")})};d.fn.updateValueEvent=function(){var h=this.$txt;var j=this.editor;var k,i;function g(){var l=h.html();if(i===l){return}if(j.onchange&&typeof j.onchange==="function"){j.onchange.call(j)}j.updateValue();i=l}h.on(c,function(l){if(i==null){i=h.html()}if(k){clearTimeout(k)}k=setTimeout(g,100)})};d.fn.updateMenuStyleEvent=function(){var g=this.$txt;var h=this.editor;g.on(c,function(i){h.updateMenuStyle()})};d.fn.insertEmptyP=function(){var h=this.$txt;var g=h.children();if(g.length===0){h.append(e("<p><br></p>"));return}if(e.trim(g.last().html()).toLowerCase()!=="<br>"){h.append(e("<p><br></p>"))}};d.fn.wrapImgAndText=function(){var h=this.$txt;var l=h.children("img");var g=h[0];var o=g.childNodes;var n=o.length;var k,j,m;l.length&&l.each(function(){e(this).wrap("<p>")});for(k=0;k<n;k++){j=o[k];if(j.nodeType===3&&j.textContent&&e.trim(j.textContent)){e(j).wrap("<p>")}}};d.fn.clearEmptyOrNestP=function(){var h=this.$txt;var g=h.find("p");g.each(function(){var j=e(this);var i=j.children();var m=i.length;var l;var k=e.trim(j.html());if(!k){j.remove();return}if(m===1){l=i.first();if(l.get(0)&&l.get(0).nodeName==="P"){j.html(l.html())}}})};d.fn.scrollTop=function(j){var h=this;var i=h.editor;var g=h.$txt;if(i.useMaxHeight){return g.parent().scrollTop(j)}else{return g.scrollTop(j)}};d.fn.showHeightOnHover=function(){var j=this.editor;var m=j.$editorContainer;var l=j.menuContainer;var i=this.$txt;var n=e('<i class="height-tip"><i>');var h=false;function g(q){if(!h){m.append(n);h=true}var t=i.position().top;var s=i.outerHeight();var x=q.height();var v=q.position().top;var o=parseInt(q.css("margin-top"),10);var y=parseInt(q.css("padding-top"),10);var r=parseInt(q.css("margin-bottom"),10);var p=parseInt(q.css("padding-bottom"),10);var w=x+y+o+p+r;var u=v+l.height();n.css({height:x+y+o+p+r,top:v+l.height()})}function k(){if(!h){return}n.remove();h=false}i.on("mouseenter","ul,ol,blockquote,p,h1,h2,h3,h4,h5,table,pre",function(o){g(e(o.currentTarget))}).on("mouseleave",function(){k()})}});a(function(f,e){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(j){var g=0,h=this.length;for(;g<h;g++){if(this[g]===j){return g}}return -1};Array.prototype.lastIndexOf=function(h){var g=this.length;for(g=g-1;g>=0;g--){if(this[g]===h){return g}}return -1}}if(!Date.now){Date.now=function(){return new Date().valueOf()}}var c=window.console;var d=function(){};e.each(["info","log","warn","error"],function(g,h){if(c==null){f[h]=d}else{f[h]=function(i){if(f.config&&f.config.printLog){c[h]("wangEditor提示: "+i)}}}});f.random=function(){return Math.random().toString().slice(2)};f.placeholder="placeholder" in document.createElement("input");f.placeholderForIE8=function(g){if(f.placeholder){return}g.find("input[placeholder]").each(function(){var i=e(this);var h=i.attr("placeholder");if(i.val()===""){i.css("color","#666");i.val(h);i.on("focus.placeholder click.placeholder",function(){i.val("");i.css("color","#333");i.off("focus.placeholder click.placeholder")})}})}});a(function(d,c){d.langs={};d.langs["zh-cn"]={bold:"粗体",underline:"下划线",italic:"斜体",forecolor:"文字颜色",bgcolor:"背景色",strikethrough:"删除线",eraser:"清空格式",source:"源码",quote:"引用",fontfamily:"字体",fontsize:"字号",head:"标题",orderlist:"有序列表",unorderlist:"无序列表",alignleft:"左对齐",aligncenter:"居中",alignright:"右对齐",link:"链接",text:"文本",submit:"提交",cancel:"取消",unlink:"取消链接",table:"表格",emotion:"表情",img:"图片",video:"视频",width:"宽",height:"高",location:"位置",loading:"加载中",searchlocation:"搜索位置",dynamicMap:"动态地图",clearLocation:"清除位置",langDynamicOneLocation:"动态地图只能显示一个位置",insertcode:"插入代码",undo:"撤销",redo:"重复",fullscreen:"全屏",openLink:"打开链接"};d.langs.en={bold:"Bold",underline:"Underline",italic:"Italic",forecolor:"Color",bgcolor:"Backcolor",strikethrough:"Strikethrough",eraser:"Eraser",source:"Codeview",quote:"Quote",fontfamily:"Font family",fontsize:"Font size",head:"Head",orderlist:"Ordered list",unorderlist:"Unordered list",alignleft:"Align left",aligncenter:"Align center",alignright:"Align right",link:"Insert link",text:"Text",submit:"Submit",cancel:"Cancel",unlink:"Unlink",table:"Table",emotion:"Emotions",img:"Image",video:"Video",width:"width",height:"height",location:"Location",loading:"Loading",searchlocation:"search",dynamicMap:"Dynamic",clearLocation:"Clear",langDynamicOneLocation:"Only one location in dynamic map",insertcode:"Insert Code",undo:"Undo",redo:"Redo",fullscreen:"Full screnn",openLink:"open link"}});a(function(d,c){d.config={};d.config.zindex=10000;d.config.printLog=true;d.config.menuFixed=0;d.config.jsFilter=true;d.config.legalTags="p,h1,h2,h3,h4,h5,h6,blockquote,table,ul,ol,pre";d.config.lang=d.langs["zh-cn"];d.config.menus=["source","|","bold","underline","italic","strikethrough","eraser","forecolor","bgcolor","|","quote","fontfamily","fontsize","head","unorderlist","orderlist","alignleft","aligncenter","alignright","|","link","unlink","table","emotion","|","img","video","location","insertcode","|","undo","redo","fullscreen"];d.config.colors={"#880000":"暗红色","#800080":"紫色","#ff0000":"红色","#ff00ff":"鲜粉色","#000080":"深蓝色","#0000ff":"蓝色","#00ffff":"湖蓝色","#008080":"蓝绿色","#008000":"绿色","#808000":"橄榄色","#00ff00":"浅绿色","#ffcc00":"橙黄色","#808080":"灰色","#c0c0c0":"银色","#000000":"黑色","#ffffff":"白色"};d.config.familys=["宋体","黑体","楷体","微软雅黑","Arial","Verdana","Georgia","Times New Roman","Microsoft JhengHei","Trebuchet MS","Courier New","Impact","Comic Sans MS","Consolas"];d.config.fontsizes={1:"12px",2:"13px",3:"16px",4:"18px",5:"24px",6:"32px",7:"48px"};d.config.emotionsShow="icon";d.config.emotions={weibo:{title:"微博表情",data:[{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/7a/shenshou_thumb.gif",value:"[草泥马]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/60/horse2_thumb.gif",value:"[神马]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/fuyun_thumb.gif",value:"[浮云]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c9/geili_thumb.gif",value:"[给力]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/f2/wg_thumb.gif",value:"[围观]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/70/vw_thumb.gif",value:"[威武]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6e/panda_thumb.gif",value:"[熊猫]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/81/rabbit_thumb.gif",value:"[兔子]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/otm_thumb.gif",value:"[奥特曼]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/15/j_thumb.gif",value:"[囧]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/89/hufen_thumb.gif",value:"[互粉]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c4/liwu_thumb.gif",value:"[礼物]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/ac/smilea_thumb.gif",value:"[呵呵]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/0b/tootha_thumb.gif",value:"[哈哈]"}]}};d.config.mapAk="TVhjYjq1ICT2qqL5LdS8mwas";d.config.uploadImgUrl="";d.config.uploadTimeout=20*1000;d.config.uploadImgFns={};d.config.customUpload=false;d.config.uploadParams={};d.config.uploadHeaders={};d.config.hideLinkImg=false;d.config.pasteFilter=true;d.config.pasteText=false});a(function(d,c){d.UI={};d.UI.menus={"default":{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-command"></i></a>',selected:".selected"},bold:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-bold"></i></a>',selected:".selected"},underline:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-underline"></i></a>',selected:".selected"},italic:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-italic"></i></a>',selected:".selected"},forecolor:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-pencil"></i></a>',selected:".selected"},bgcolor:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-brush"></i></a>',selected:".selected"},strikethrough:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-strikethrough"></i></a>',selected:".selected"},eraser:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-eraser"></i></a>',selected:".selected"},quote:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-quotes-left"></i></a>',selected:".selected"},source:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-code"></i></a>',selected:".selected"},fontfamily:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-font2"></i></a>',selected:".selected"},fontsize:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-text-height"></i></a>',selected:".selected"},head:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-header"></i></a>',selected:".selected"},orderlist:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-list-numbered"></i></a>',selected:".selected"},unorderlist:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-list-bullet"></i></a>',selected:".selected"},alignleft:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-left"></i></a>',selected:".selected"},aligncenter:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-center"></i></a>',selected:".selected"},alignright:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-right"></i></a>',selected:".selected"},link:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-link"></i></a>',selected:".selected"},unlink:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-unlink"></i></a>',selected:".selected"},table:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-table"></i></a>',selected:".selected"},emotion:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-happy"></i></a>',selected:".selected"},img:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-picture"></i></a>',selected:".selected"},video:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-play"></i></a>',selected:".selected"},location:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-location"></i></a>',selected:".selected"},insertcode:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-terminal"></i></a>',selected:".selected"},undo:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-ccw"></i></a>',selected:".selected"},redo:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-cw"></i></a>',selected:".selected"},fullscreen:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-enlarge2"></i></a>',selected:'<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-shrink2"></i></a>'}}});a(function(d,c){d.fn.initDefaultConfig=function(){var e=this;e.config=c.extend({},d.config);e.UI=c.extend({},d.UI)}});a(function(d,c){d.fn.addEditorContainer=function(){this.$editorContainer=c('<div class="wangEditor-container"></div>')}});a(function(d,c){d.fn.addTxt=function(){var f=this;var e=new d.Txt(f);f.txt=e}});a(function(d,c){d.fn.addMenuContainer=function(){var e=this;e.menuContainer=new d.MenuContainer(e)}});a(function(d,c){d.createMenuFns=[];d.createMenu=function(e){d.createMenuFns.push(e)};d.fn.addMenus=function(){var g=this;var f=g.config.menus;function e(h){if(f.indexOf(h)>=0){return true}return false}c.each(d.createMenuFns,function(h,i){i.call(g,e)})}});a(function(d,c){d.createMenu(function(e){var i="bold";if(!e(i)){return}var f=this;var h=f.config.lang;var g=new d.Menu({editor:f,id:i,title:h.bold,commandName:"Bold"});g.clickEventSelected=function(k){var j=f.isRangeEmpty();if(!j){f.command(k,"Bold")}else{f.commandForElem("b,strong,h1,h2,h3,h4,h5",k,"Bold")}};f.menus[i]=g})});a(function(d,c){d.createMenu(function(e){var i="underline";if(!e(i)){return}var f=this;var h=f.config.lang;var g=new d.Menu({editor:f,id:i,title:h.underline,commandName:"Underline"});g.clickEventSelected=function(k){var j=f.isRangeEmpty();if(!j){f.command(k,"Underline")}else{f.commandForElem("u,a",k,"Underline")}};f.menus[i]=g})});a(function(d,c){d.createMenu(function(e){var i="italic";if(!e(i)){return}var f=this;var h=f.config.lang;var g=new d.Menu({editor:f,id:i,title:h.italic,commandName:"Italic"});g.clickEventSelected=function(k){var j=f.isRangeEmpty();if(!j){f.command(k,"Italic")}else{f.commandForElem("i",k,"Italic")}};f.menus[i]=g})});a(function(d,c){d.createMenu(function(e){var k="forecolor";if(!e(k)){return}var h=this;var j=h.config.lang;var f=h.config.colors;var i=new d.Menu({editor:h,id:k,title:j.forecolor});var g=c("<div></div>");c.each(f,function(m,l){g.append(['<a href="#" class="color-item"','    title="'+l+'" commandValue="'+m+'" ','    style="color: '+m+'" ','><i class="wangeditor-menu-img-pencil"></i></a>'].join(""))});g.on("click","a[commandValue]",function(n){var m=c(this);var l=m.attr("commandValue");if(i.selected&&h.isRangeEmpty()){h.commandForElem("font[color]",n,"forecolor",l)}else{h.command(n,"forecolor",l)}});i.dropPanel=new d.DropPanel(h,i,{$content:g,width:125});i.updateSelectedEvent=function(){var l=h.getRangeElem();l=h.getSelfOrParentByName(l,"font[color]");if(l){return true}return false};h.menus[k]=i})});a(function(d,c){d.createMenu(function(e){var l="bgcolor";if(!e(l)){return}var h=this;var k=h.config.lang;var f=h.config.colors;function i(n){var m;if(n&&n.style&&n.style.cssText!=null){m=n.style.cssText;if(m&&m.indexOf("background-color:")>=0){return true}}return false}var j=new d.Menu({editor:h,id:l,title:k.bgcolor});var g=c("<div></div>");c.each(f,function(n,m){g.append(['<a href="#" class="color-item"','    title="'+m+'" commandValue="'+n+'" ','    style="color: '+n+'" ','><i class="wangeditor-menu-img-brush"></i></a>'].join(""))});g.on("click","a[commandValue]",function(o){var n=c(this);var m=n.attr("commandValue");if(j.selected&&h.isRangeEmpty()){h.commandForElem({selector:"span,font",check:i},o,"BackColor",m)}else{h.command(o,"BackColor",m)}});j.dropPanel=new d.DropPanel(h,j,{$content:g,width:125});j.updateSelectedEvent=function(){var m=h.getRangeElem();m=h.getSelfOrParentByName(m,"span,font",i);if(m){return true}return false};h.menus[l]=j})});a(function(d,c){d.createMenu(function(e){var i="strikethrough";if(!e(i)){return}var f=this;var h=f.config.lang;var g=new d.Menu({editor:f,id:i,title:h.strikethrough,commandName:"StrikeThrough"});g.clickEventSelected=function(k){var j=f.isRangeEmpty();if(!j){f.command(k,"StrikeThrough")}else{f.commandForElem("strike",k,"StrikeThrough")}};f.menus[i]=g})});a(function(d,c){d.createMenu(function(e){var i="eraser";if(!e(i)){return}var f=this;var h=f.config.lang;var g=new d.Menu({editor:f,id:i,title:h.eraser,commandName:"RemoveFormat"});g.clickEvent=function(m){var j=f.isRangeEmpty();if(!j){f.command(m,"RemoveFormat");return}var l;function k(){var t=this;var o;var s,p;var v,q;var u,r;o=t.getRangeElem();v=t.getSelfOrParentByName(o,"blockquote");if(v){q=c(v);l=c("<p>"+q.text()+"</p>");q.after(l).remove()}s=t.getSelfOrParentByName(o,"p,h1,h2,h3,h4,h5");if(s){p=c(s);l=c("<p>"+p.text()+"</p>");p.after(l).remove()}u=t.getSelfOrParentByName(o,"ul,ol");if(u){r=c(u);l=c("<p>"+r.text()+"</p>");r.after(l).remove()}}function n(){var o=this;if(l){o.restoreSelectionByElem(l.get(0))}}f.customCommand(m,k,n)};f.menus[i]=g})});a(function(d,c){d.createMenu(function(f){var k="source";if(!f(k)){return}var h=this;var j=h.config.lang;var g;var i=new d.Menu({editor:h,id:k,title:j.source});i.isShowCode=false;function e(){var m=i.$codeTextarea;var l=h.txt.$txt;var n=c.trim(m.val());if(!n){n="<p><br></p>"}if(h.config.jsFilter){n=n.replace(/<script[\s\S]*?<\/script>/ig,"")}l.html(n)}i.clickEvent=function(q){var n=this;var p=n.editor;var m=p.txt.$txt;var r=m.outerHeight();var o=m.height();if(!n.$codeTextarea){n.$codeTextarea=c('<textarea class="code-textarea"></textarea>')}var l=n.$codeTextarea;l.css({height:o,"margin-top":r-o});l.val(m.html());m.after(l).hide();l.show();i.isShowCode=true;this.updateSelected();p.disableMenusExcept("source");g=m.html()};i.clickEventSelected=function(q){var n=this;var o=n.editor;var m=o.txt.$txt;var l=n.$codeTextarea;var p;if(!l){return}e();l.after(m).hide();m.show();i.isShowCode=false;this.updateSelected();o.enableMenusExcept("source");if(m.html()!==g){if(o.onchange&&typeof o.onchange==="function"){o.onchange.call(o)}}};i.updateSelectedEvent=function(){return this.isShowCode};h.menus[k]=i})});a(function(d,c){d.createMenu(function(e){var i="quote";if(!e(i)){return}var f=this;var h=f.config.lang;var g=new d.Menu({editor:f,id:i,title:h.quote,commandName:"formatBlock",commandValue:"blockquote"});g.clickEvent=function(n){var k=f.getRangeElem();var m;if(!k){n.preventDefault();return}var j=f.getSelfOrParentByName(k,"blockquote");var p;if(j){n.preventDefault();return}k=f.getLegalTags(k);m=c(k);if(!m.text()){return}if(!k){f.command(n,"formatBlock","blockquote");return}function l(){p=c("<p>"+m.text()+"</p>");m.after(p).remove();p.wrap("<blockquote>")}function o(){var q=this;if(p){q.restoreSelectionByElem(p.get(0))}}f.customCommand(n,l,o)};g.clickEventSelected=function(n){var j;var m;var k;j=f.getRangeElem();m=f.getSelfOrParentByName(j,"blockquote");if(!m){n.preventDefault();return}function l(){var q;var p;q=c(m);p=q.children();if(p.length){p.each(function(s){var r=c(this);if(r.get(0).nodeName==="P"){q.after(r)}else{q.after("<p>"+r.text()+"</p>")}k=r});q.remove();return}}function o(){var p=this;if(k){p.restoreSelectionByElem(k.get(0))}}f.customCommand(n,l,o)};g.updateSelectedEvent=function(){var k=this;var l=k.editor;var j;j=l.getRangeElem();j=l.getSelfOrParentByName(j,"blockquote");if(j){return true}return false};f.menus[i]=g;f.ready(function(){var l=this;var j=l.txt.$txt;var k=false;j.on("keydown",function(p){if(p.keyCode!==13){k=false;return}var m=l.getRangeElem();m=l.getSelfOrParentByName(m,"blockquote");if(!m){k=false;return}if(!k){k=true;return}var n=l.getRangeElem();var o=c(n);if(o.length){o.parent().after(o)}l.restoreSelectionByElem(n,"start");k=false;p.preventDefault()})});f.ready(function(){var k=this;var j=k.txt.$txt;var m;function l(){m&&m.remove()}function n(){if(!m){return}var o=m.prev();if(o.length){k.restoreSelectionByElem(o.get(0))}else{k.initSelection()}}j.on("keydown",function(p){if(p.keyCode!==8){return}var o=k.getRangeElem();o=k.getSelfOrParentByName(o,"blockquote");if(!o){return}m=c(o);var q=m.text();if(q){return}k.customCommand(p,l,n)})})})});a(function(d,c){d.createMenu(function(e){var l="fontfamily";if(!e(l)){return}var h=this;var k=h.config.lang;var g=h.config.familys;var j=new d.Menu({editor:h,id:l,title:k.fontfamily,commandName:"fontName"});var i={};c.each(g,function(n,m){i[m]=m});var f='<span style="font-family:{#commandValue};">{#title}</span>';j.dropList=new d.DropList(h,j,{data:i,tpl:f,selectorForELemCommand:"font[face]"});j.updateSelectedEvent=function(){var m=h.getRangeElem();m=h.getSelfOrParentByName(m,"font[face]");if(m){return true}return false};h.menus[l]=j})});a(function(d,c){d.createMenu(function(e){var l="fontsize";if(!e(l)){return}var g=this;var k=g.config.lang;var j=g.config.fontsizes;var i=new d.Menu({editor:g,id:l,title:k.fontsize,commandName:"fontSize"});var h=j;var f='<span style="font-size:{#title};">{#title}</span>';i.dropList=new d.DropList(g,i,{data:h,tpl:f,selectorForELemCommand:"font[size]"});i.updateSelectedEvent=function(){var m=g.getRangeElem();m=g.getSelfOrParentByName(m,"font[size]");if(m){return true}return false};g.menus[l]=i})});a(function(d,c){d.createMenu(function(e){var k="head";if(!e(k)){return}var j=this;var f=j.config.lang;var g=new d.Menu({editor:j,id:k,title:f.head,commandName:"formatBlock"});var h={"<h1>":"标题1","<h2>":"标题2","<h3>":"标题3","<h4>":"标题4","<h5>":"标题5"};var l;function n(o){if(j.queryCommandState("InsertOrderedList")){l=true;j.command(o,"InsertOrderedList")}else{l=false}}function m(o){if(l){j.command(o,"InsertOrderedList")}}var i="{#commandValue}{#title}";g.dropList=new d.DropList(j,g,{data:h,tpl:i,beforeEvent:n,afterEvent:m});g.updateSelectedEvent=function(){var o=j.getRangeElem();o=j.getSelfOrParentByName(o,"h1,h2,h3,h4,h5");if(o){return true}return false};j.menus[k]=g})});a(function(d,c){d.createMenu(function(e){var i="unorderlist";if(!e(i)){return}var f=this;var h=f.config.lang;var g=new d.Menu({editor:f,id:i,title:h.unorderlist,commandName:"InsertUnorderedList"});f.menus[i]=g})});a(function(d,c){d.createMenu(function(e){var i="orderlist";if(!e(i)){return}var f=this;var h=f.config.lang;var g=new d.Menu({editor:f,id:i,title:h.orderlist,commandName:"InsertOrderedList"});f.menus[i]=g})});a(function(d,c){d.createMenu(function(e){var i="alignleft";if(!e(i)){return}var f=this;var h=f.config.lang;var g=new d.Menu({editor:f,id:i,title:h.alignleft,commandName:"JustifyLeft"});g.updateSelectedEvent=function(){var j=f.getRangeElem();j=f.getSelfOrParentByName(j,"p,h1,h2,h3,h4,h5,li",function(l){var k;if(l&&l.style&&l.style.cssText!=null){k=l.style.cssText;if(k&&/text-align:\s*left;/.test(k)){return true}}if(c(l).attr("align")==="left"){return true}return false});if(j){return true}return false};f.menus[i]=g})});a(function(d,c){d.createMenu(function(e){var i="aligncenter";if(!e(i)){return}var f=this;var h=f.config.lang;var g=new d.Menu({editor:f,id:i,title:h.aligncenter,commandName:"JustifyCenter"});g.updateSelectedEvent=function(){var j=f.getRangeElem();j=f.getSelfOrParentByName(j,"p,h1,h2,h3,h4,h5,li",function(l){var k;if(l&&l.style&&l.style.cssText!=null){k=l.style.cssText;if(k&&/text-align:\s*center;/.test(k)){return true}}if(c(l).attr("align")==="center"){return true}return false});if(j){return true}return false};f.menus[i]=g})});a(function(d,c){d.createMenu(function(e){var i="alignright";if(!e(i)){return}var f=this;var h=f.config.lang;var g=new d.Menu({editor:f,id:i,title:h.alignright,commandName:"JustifyRight"});g.updateSelectedEvent=function(){var j=f.getRangeElem();j=f.getSelfOrParentByName(j,"p,h1,h2,h3,h4,h5,li",function(l){var k;if(l&&l.style&&l.style.cssText!=null){k=l.style.cssText;if(k&&/text-align:\s*right;/.test(k)){return true}}if(c(l).attr("align")==="right"){return true}return false});if(j){return true}return false};f.menus[i]=g})});a(function(d,c){d.createMenu(function(g){var p="link";if(!g(p)){return}var o=this;var j=o.config.lang;var k=new d.Menu({editor:o,id:p,title:j.link});var f=c("<div></div>");var n=c('<div style="margin:20px 10px;" class="clearfix"></div>');var m=n.clone();var l=n.clone().css("margin","0 10px");var i=c('<input type="text" class="block" placeholder="'+j.text+'"/>');var h=c('<input type="text" class="block" placeholder="'+j.link+'"/>');var q=c('<button class="right">'+j.submit+"</button>");var e=c('<button class="right gray">'+j.cancel+"</button>");n.append(i);m.append(h);l.append(q).append(e);f.append(n).append(m).append(l);k.dropPanel=new d.DropPanel(o,k,{$content:f,width:300});k.clickEvent=function(v){var x=this;var s=x.dropPanel;if(s.isShowing){s.hide();return}i.val("");h.val("http://");var u="";var r=o.getRangeElem();r=o.getSelfOrParentByName(r,"a");if(r){u=r.href||""}var w="";var t=o.isRangeEmpty();if(!t){w=o.getRangeText()||""}else{if(r){w=r.textContent||r.innerHTML}}u&&h.val(u);w&&i.val(w);if(!t){i.attr("disabled",true)}else{i.removeAttr("disabled")}s.show()};k.updateSelectedEvent=function(){var r=o.getRangeElem();r=o.getSelfOrParentByName(r,"a");if(r){return true}return false};e.click(function(r){r.preventDefault();k.dropPanel.hide()});q.click(function(v){v.preventDefault();var C=o.getRangeElem();var w=o.getSelfOrParentByName(C,"a");var E=o.isRangeEmpty();var t,y;var D,B;var r=o.txt.$txt;var u,z;var x="link"+d.random();var s=c.trim(h.val());var A=c.trim(i.val());if(!s){k.dropPanel.focusFirstInput();return}if(!A){A=s}if(!E){u=r.find("a");u.attr(x,"1");o.command(v,"createLink",s);z=r.find("a").not("["+x+"]");z.attr("target","_blank");u.removeAttr(x)}else{if(w){t=c(w);D=function(){t.attr("href",s);t.text(A)};B=function(){var F=this;F.restoreSelectionByElem(w)};o.customCommand(v,D,B)}else{y='<a href="'+s+'" target="_blank">'+A+"</a>";if(d.userAgent.indexOf("Firefox")>0){y+="<span>&nbsp;</span>"}o.command(v,"insertHtml",y)}}});o.menus[p]=k})});a(function(d,c){d.createMenu(function(e){var i="unlink";if(!e(i)){return}var f=this;var h=f.config.lang;var g=new d.Menu({editor:f,id:i,title:h.unlink,commandName:"unLink"});g.clickEvent=function(p){var l=f.isRangeEmpty();if(!l){f.command(p,"unLink");return}var j=f.getRangeElem();var m=f.getSelfOrParentByName(j,"a");if(!m){p.preventDefault();return}var o=c(m);var k=c("<span>"+o.text()+"</span>");function n(){o.after(k).remove()}function q(){f.restoreSelectionByElem(k.get(0))}f.customCommand(p,n,q)};f.menus[i]=g})});a(function(d,c){d.createMenu(function(f){var p="table";if(!f(p)){return}var n=this;var g=n.config.lang;var h=new d.Menu({editor:n,id:p,title:g.table});var e=c('<div style="font-size: 14px; color: #666; text-align:right;"></div>');var t=c('<table class="choose-table" style="margin-bottom:10px;margin-top:5px;">');var o=c("<span>0</span>");var s=c("<span> 行 </span>");var r=c("<span>0</span>");var q=c("<span> 列</span>");var m;var l,k;for(l=0;l<15;l++){m=c('<tr index="'+(l+1)+'">');for(k=0;k<20;k++){m.append(c('<td index="'+(k+1)+'">'))}t.append(m)}e.append(t);e.append(o).append(s).append(r).append(q);t.on("mouseenter","td",function(w){var v=c(w.currentTarget);var u=v.attr("index");var j=v.parent();var i=j.attr("index");o.text(i);r.text(u);t.find("tr").each(function(){var y=c(this);var x=y.attr("index");if(parseInt(x,10)<=parseInt(i,10)){y.find("td").each(function(){var A=c(this);var z=A.attr("index");if(parseInt(z,10)<=parseInt(u,10)){A.addClass("active")}else{A.removeClass("active")}})}else{y.find("td").removeClass("active")}})}).on("mouseleave",function(i){t.find("td").removeClass("active");o.text(0);r.text(0)});t.on("click","td",function(B){var C=c(B.currentTarget);var v=C.attr("index");var w=C.parent();var y=w.attr("index");var D=parseInt(y,10);var u=parseInt(v,10);var A,z;var x="<table>";for(A=0;A<D;A++){x+="<tr>";for(z=0;z<u;z++){x+="<td><span>&nbsp;</span></td>"}x+="</tr>"}x+="</table>";n.command(B,"insertHtml",x)});h.dropPanel=new d.DropPanel(n,h,{$content:e,width:262});n.menus[p]=h})});a(function(d,c){d.createMenu(function(f){var n="emotion";if(!f(n)){return}var m=this;var j=m.config;var g=j.lang;var i=j.emotions;var p=j.emotionsShow;m.emotionUrls=[];var h=new d.Menu({editor:m,id:n,title:g.emotion});function l(r,q){c.each(r,function(u,t){var y=t.icon||t.url;var x=t.value||t.title;var s=p==="icon"?y:x;var w=c('<a href="#" commandValue="'+s+'"></a>');var v=c("<img>");v.attr("_src",y);w.append(v);q.append(w);m.emotionUrls.push(y)})}var k=c('<div class="panel-tab"></div>');var o=c('<div class="tab-container"></div>');var e=c('<div class="content-container emotion-content-container"></div>');c.each(i,function(r,q){var v=q.title;var u=q.data;d.log("正在处理 "+v+" 表情的数据...");var t=c('<a href="#">'+v+" </a>");o.append(t);var s=c('<div class="content"></div>');e.append(s);t.click(function(w){o.children().removeClass("selected");e.children().removeClass("selected");s.addClass("selected");t.addClass("selected");w.preventDefault()});if(typeof u==="string"){d.log("将通过 "+u+" 地址ajax下载表情包");c.get(u,function(w){w=c.parseJSON(w);d.log("下载完毕，得到 "+w.length+" 个表情");l(w,s)})}else{if(Object.prototype.toString.call(u).toLowerCase().indexOf("array")>0){l(u,s)}else{d.error("data 数据格式错误，请修改为正确格式，参考文档："+d.docsite);return}}});k.append(o).append(e);o.children().first().addClass("selected");e.children().first().addClass("selected");e.on("click","a[commandValue]",function(t){var s=c(t.currentTarget);var q=s.attr("commandValue");var r;if(p==="icon"){m.command(t,"InsertImage",q)}else{m.command(t,"insertHtml","<span>"+q+"</span>")}t.preventDefault()});h.dropPanel=new d.DropPanel(m,h,{$content:k,width:350});h.clickEvent=function(r){var s=this;var q=s.dropPanel;if(q.isShowing){q.hide();return}q.show();if(s.imgLoaded){return}e.find("img").each(function(){var t=c(this);var u=t.attr("_src");t.on("error",function(){d.error("加载不出表情图片 "+u)});t.attr("src",u);t.removeAttr("_src")});s.imgLoaded=true};m.menus[n]=h})});a(function(e,d){e.createMenu(function(g){var r="img";if(!g(r)){return}var p=this;var i=p.config.lang;var j=new e.Menu({editor:p,id:r,title:i.img});var l=d('<div class="panel-tab"></div>');var t=d('<div class="tab-container"></div>');var f=d('<div class="content-container"></div>');l.append(t).append(f);var s=d('<a href="#">上传图片</a>');var h=d('<a href="#">网络图片</a>');t.append(s).append(h);var m=d('<div class="content"></div>');f.append(m);var k=d('<div class="content"></div>');f.append(k);c(p,j,k);j.dropPanel=new e.DropPanel(p,j,{$content:l,width:260,onRender:function(){var u=p.config.customUploadInit;u&&u.call(p)}});p.menus[r]=j;function o(){s.click(function(u){t.children().removeClass("selected");f.children().removeClass("selected");m.addClass("selected");s.addClass("selected");u.preventDefault()});h.click(function(u){t.children().removeClass("selected");f.children().removeClass("selected");k.addClass("selected");h.addClass("selected");u.preventDefault();if(e.placeholder){k.find("input[type=text]").focus()}});s.click()}function n(){t.remove();m.remove();k.addClass("selected")}function q(){t.remove();k.remove();m.addClass("selected")}p.ready(function(){var z=this;var y=z.config;var u=y.uploadImgUrl;var w=y.customUpload;var v=y.hideLinkImg;var A;if(u||w){z.$uploadContent=m;o();if(v){q()}}else{n()}function x(){j.dropPanel.hide()}m.click(function(){setTimeout(x)})})});function c(l,g,j){var h=l.config.lang;var k=d('<div style="margin:20px 10px 10px 10px;"></div>');var i=d('<input type="text" class="block" placeholder="http://"/>');k.append(i);var m=d('<button class="right">'+h.submit+"</button>");var f=d('<button class="right gray">'+h.cancel+"</button>");j.append(k).append(m).append(f);f.click(function(o){o.preventDefault();g.dropPanel.hide()});function n(){i.val("")}m.click(function(q){q.preventDefault();var o=d.trim(i.val());if(!o){i.focus();return}var p='<img style="max-width:100%;" src="'+o+'"/>';l.command(q,"insertHtml",p,n)})}});a(function(d,c){d.createMenu(function(g){var p="video";if(!g(p)){return}var m=this;var h=m.config.lang;var j=/^<(iframe)|(embed)/i;var i=new d.Menu({editor:m,id:p,title:h.video});var f=c("<div></div>");var k=c('<div style="margin:20px 10px;"></div>');var o=c('<input type="text" class="block" placeholder=\'格式如：<iframe src="..." frameborder=0 allowfullscreen></iframe>\'/>');k.append(o);var q=c('<div style="margin:20px 10px;"></div>');var l=c('<input type="text" value="640" style="width:50px;text-align:center;"/>');var n=c('<input type="text" value="498" style="width:50px;text-align:center;"/>');q.append("<span> "+h.width+" </span>").append(l).append("<span> px &nbsp;&nbsp;&nbsp;</span>").append("<span> "+h.height+" </span>").append(n).append("<span> px </span>");var s=c("<div></div>");var t=c('<a href="http://www.kancloud.cn/wangfupeng/wangeditor2/134973" target="_blank" style="display:inline-block;margin-top:10px;margin-left:10px;color:#999;">如何复制视频链接？</a>');var r=c('<button class="right">'+h.submit+"</button>");var e=c('<button class="right gray">'+h.cancel+"</button>");s.append(t).append(r).append(e);f.append(k).append(q).append(s);e.click(function(u){u.preventDefault();o.val("");i.dropPanel.hide()});r.click(function(A){A.preventDefault();var z=c.trim(o.val());var w;var y=parseInt(l.val());var u=parseInt(n.val());var v=c("<div>");var x='<p style="text-align:center;">{content}</p>';if(!z){i.dropPanel.focusFirstInput();return}if(!j.test(z)){alert("视频链接格式错误！");i.dropPanel.focusFirstInput();return}if(isNaN(y)||isNaN(u)){alert("宽度或高度不是数字！");return}w=c(z);w.attr("width",y).attr("height",u);x=x.replace("{content}",v.append(w).html());m.command(A,"insertHtml",x);o.val("")});i.dropPanel=new d.DropPanel(m,i,{$content:f,width:260});m.menus[p]=i})});a(function(e,d){var c=(function(f){return"onkeyup" in f})(document.createElement("input"));e.baiduMapAk="TVhjYjq1ICT2qqL5LdS8mwas";e.numberOfLocation=0;e.createMenu(function(x){var p="location";if(!x(p)){return}if(++e.numberOfLocation>1){e.error("目前不支持在一个页面多个编辑器上同时使用地图，可通过自定义菜单配置去掉地图菜单");return}var h=this;var y=h.config;var A=y.lang;var v=y.mapAk;h.mapData={};var t=h.mapData;t.markers=[];t.mapContainerId="map"+e.random();t.clearLocations=function(){var B=t.map;if(!B){return}B.clearOverlays();t.markers=[]};t.searchMap=function(){var F=t.map;if(!F){return}var E=window.BMap;var C=n.val();var D=f.val();var G,B;if(C!==""){if(!D||D===""){F.centerAndZoom(C,11)}if(D&&D!==""){G=new E.Geocoder();G.getPoint(D,function(H){if(H){F.centerAndZoom(H,13);B=new E.Marker(H);F.addOverlay(B);B.enableDragging();t.markers.push(B)}else{F.centerAndZoom(C,11)}},C)}}};var w=false;window.baiduMapCallBack=function(){if(w){return}else{w=true}var C=window.BMap;if(!t.map){t.map=new C.Map(t.mapContainerId)}var D=t.map;D.centerAndZoom(new C.Point(116.404,39.915),11);D.addControl(new C.MapTypeControl());D.setCurrentCity("北京");D.enableScrollWheelZoom(true);function B(F){var G=F.name;D.setCenter(G);n.val(G);if(e.placeholder){f.focus()}var I,H;if(c){H=function(J){if(J.type==="keyup"&&J.keyCode===13){J.preventDefault()}if(I){clearTimeout(I)}I=setTimeout(t.searchMap,500)};n.on("keyup change paste",H);f.on("keyup change paste",H)}else{H=function(){if(!i.is(":visible")){clearTimeout(I);return}var L="";var K="";var M=n.val();var J=f.val();if(M!==L||J!==K){t.searchMap();L=M;K=J}if(I){clearTimeout(I)}I=setTimeout(H,1000)};I=setTimeout(H,1000)}}var E=new C.LocalCity();E.get(B);D.addEventListener("click",function(G){var F=new C.Marker(new C.Point(G.point.lng,G.point.lat));D.addOverlay(F);F.enableDragging();t.markers.push(F)},false)};t.loadMapScript=function(){var B=document.createElement("script");B.type="text/javascript";B.src="https://api.map.baidu.com/api?v=2.0&ak="+v+"&s=1&callback=baiduMapCallBack";try{document.body.appendChild(B)}catch(C){e.error("加载地图过程中发生错误")}};t.initMap=function(){if(window.BMap){window.baiduMapCallBack()}else{t.loadMapScript()}};var g=new e.Menu({editor:h,id:p,title:A.location});h.menus[p]=g;var i=d("<div></div>");var z=d('<div style="margin:10px 0;"></div>');var n=d('<input type="text"/>');n.css({width:"80px","text-align":"center"});var f=d('<input type="text"/>');f.css({width:"300px","margin-left":"10px"}).attr("placeholder",A.searchlocation);var s=d('<button class="right link">'+A.clearLocation+"</button>");z.append(s).append(n).append(f);i.append(z);s.click(function(B){f.val("");f.focus();t.clearLocations();B.preventDefault()});var k=d('<div id="'+t.mapContainerId+'"></div>');k.css({height:"260px",width:"100%",position:"relative","margin-top":"10px",border:"1px solid #f1f1f1"});var q=d("<span>"+A.loading+"</span>");q.css({position:"absolute",width:"100px","text-align":"center",top:"45%",left:"50%","margin-left":"-50px"});k.append(q);i.append(k);var r=d('<div style="margin:10px 0;"></div>');var u=d('<button class="right">'+A.submit+"</button>");var l=d('<button class="right gray">'+A.cancel+"</button>");var m=d('<label style="display:inline-block;margin-top:10px;color:#666;"></label>');var o=d('<input type="checkbox">');m.append(o).append('<span style="display:inline-block;margin-left:5px;">  '+A.dynamicMap+"</span>");r.append(m).append(u).append(l);i.append(r);function j(){f.val("")}l.click(function(B){B.preventDefault();j();g.dropPanel.hide()});u.click(function(L){L.preventDefault();var E=t.map,M=o.is(":checked"),I=t.markers,D=E.getCenter(),G=D.lng,F=D.lat,N=E.getZoom(),O=E.getSize(),C=O.width,K=O.height,J,B,H;if(M){B="http://ueditor.baidu.com/ueditor/dialogs/map/show.html#"}else{B="http://api.map.baidu.com/staticimage?"}B=B+"center="+G+","+F+"&zoom="+N+"&width="+C+"&height="+K;if(I.length>0){B=B+"&markers=";d.each(I,function(P,Q){J=Q.getPosition();if(P>0){B=B+"|"}B=B+J.lng+","+J.lat})}if(M){if(I.length>1){alert(A.langDynamicOneLocation);return}B+="&markerStyles=l,A";H='<iframe class="ueditor_baidumap" src="{src}" frameborder="0" width="'+C+'" height="'+K+'"></iframe>';H=H.replace("{src}",B);h.command(L,"insertHtml",H,j)}else{h.command(L,"insertHtml",'<img style="max-width:100%;" src="'+B+'"/>',j)}});g.dropPanel=new e.DropPanel(h,g,{$content:i,width:500});g.onRender=function(){if(v===e.baiduMapAk){e.warn("建议在配置中自定义百度地图的mapAk，否则可能影响地图功能，文档："+e.docsite)}};g.clickEvent=function(C){var D=this;var B=D.dropPanel;var E=false;if(B.isShowing){B.hide();return}if(!t.map){E=true}B.show();t.initMap();if(!E){f.focus()}}})});a(function(e,d){function c(){if(e.userAgent.indexOf("MSIE 8")>0){return}if(window.hljs){return}var f=document.createElement("script");f.type="text/javascript";f.src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js";document.body.appendChild(f)}e.createMenu(function(i){var p="insertcode";if(!i(p)){return}setTimeout(c,0);var o=this;var j=o.config.lang;var g=o.txt.$txt;var k=new e.Menu({editor:o,id:p,title:j.insertcode});k.clickEvent=function(s){var t=this;var q=t.dropPanel;if(q.isShowing){q.hide();return}n.val("");q.show();var r=window.hljs;if(r&&r.listLanguages){if(f.children().length!==0){return}f.css({"margin-top":"9px","margin-left":"5px"});d.each(r.listLanguages(),function(u,v){f.append('<option value="'+v+'">'+v+"</option>")})}else{f.hide()}};k.clickEventSelected=function(v){var w=this;var r=w.dropPanel;if(r.isShowing){r.hide();return}r.show();var q=o.getRangeElem();var u=o.getSelfOrParentByName(q,"pre");var t;var s;if(u){u=o.getSelfOrParentByName(q,"code")}if(!u){return}t=d(u);n.val(t.text());if(f){s=t.attr("class");if(s){f.val(s.split(" ")[0])}}};k.updateSelectedEvent=function(){var r=this;var s=r.editor;var q;q=s.getRangeElem();q=s.getSelfOrParentByName(q,"pre");if(q){return true}return false};var h=d("<div></div>");var n=d("<textarea></textarea>");var f=d("<select></select>");m(h);k.dropPanel=new e.DropPanel(o,k,{$content:h,width:500});o.menus[p]=k;function m(t){var u=d("<div></div>");u.css({margin:"15px 5px 5px 5px",height:"160px","text-align":"center"});n.css({width:"100%",height:"100%",padding:"10px"});n.on("keydown",function(w){if(w.keyCode===9){w.preventDefault()}});u.append(n);t.append(u);var q=d("<div></div>");var s=d('<button class="right">'+j.submit+"</button>");var r=d('<button class="right gray">'+j.cancel+"</button>");q.append(s).append(r).append(f);t.append(q);r.click(function(w){w.preventDefault();k.dropPanel.hide()});var v='<pre style="max-width:100%;overflow-x:auto;"><code{#langClass}>{#content}</code></pre>';s.click(function(B){B.preventDefault();var y=n.val();if(!y){n.focus();return}var F=o.getRangeElem();if(d.trim(d(F).text())){v="<p><br></p>"+v}var w=f?f.val():"";var D="";var z=function(){g.find("pre code").each(function(H,J){var I=d(J);if(I.attr("codemark")){return}else{if(window.hljs){window.hljs.highlightBlock(J);I.attr("codemark","1")}}})};if(w){D=' class="'+w+' hljs"'}y=y.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;");if(!k.selected){var A=v.replace("{#langClass}",D).replace("{#content}",y);o.command(B,"insertHtml",A,z);return}var C=o.getSelfOrParentByName(F,"pre");var x;if(C){C=o.getSelfOrParentByName(F,"code")}if(!C){return}x=d(C);function G(){var H;if(w){H=x.attr("class");if(H!==w+" hljs"){x.attr("class",w+" hljs")}}x.html(y)}function E(){o.restoreSelectionByElem(C);z()}o.customCommand(B,G,E)})}g.on("keydown",function(s){if(s.keyCode!==13){return}var q=o.getRangeElem();var r=o.getSelfOrParentByName(q,"code");if(!r){return}o.command(s,"insertHtml","\n")});function l(){var q=o.getRangeElem();var r=o.getSelfOrParentByName(q,"code");if(r){o.disableMenusExcept("insertcode")}else{o.enableMenusExcept("insertcode")}}g.on("keydown click",function(q){setTimeout(l)})})});a(function(d,c){d.createMenu(function(e){var i="undo";if(!e(i)){return}var f=this;var h=f.config.lang;var g=new d.Menu({editor:f,id:i,title:h.undo});g.clickEvent=function(j){f.undo()};f.menus[i]=g;f.ready(function(){var l=this;var k=l.txt.$txt;var m;function j(){l.undoRecord()}k.on("keydown",function(o){var n=o.keyCode;if(o.ctrlKey&&n===90){l.undo();return}if(n===13){j()}else{if(m){clearTimeout(m)}m=setTimeout(j,1000)}});l.undoRecord()})})});a(function(d,c){d.createMenu(function(e){var i="redo";if(!e(i)){return}var f=this;var h=f.config.lang;var g=new d.Menu({editor:f,id:i,title:h.redo});g.clickEvent=function(j){f.redo()};f.menus[i]=g})});a(function(e,d){var c;e.createMenu(function(h){var m="fullscreen";if(!h(m)){return}var l=this;var f=l.txt.$txt;var k=l.config;var n=k.zindex||10000;var j=k.lang;var g=false;var o;var p;var i=new e.Menu({editor:l,id:m,title:j.fullscreen});i.clickEvent=function(u){var t=l.$editorContainer;t.addClass("wangEditor-fullscreen");o=t.css("z-index");t.css("z-index",n);var s;var q=f.height();var v=f.outerHeight();if(l.useMaxHeight){p=f.css("max-height");f.css("max-height","none");s=f.parent();s.after(f);s.remove();f.css("overflow-y","auto")}var r=l.menuContainer;f.height(e.$window.height()-r.height()-(v-q));l.menuContainer.$menuContainer.attr("style","");g=true;l.isFullScreen=true;c=e.$window.scrollTop()};i.clickEventSelected=function(r){var q=l.$editorContainer;q.removeClass("wangEditor-fullscreen");q.css("z-index",o);if(l.useMaxHeight){f.css("max-height",p)}else{l.$valueContainer.css("height",l.valueContainerHeight)}l.txt.initHeight();g=false;l.isFullScreen=false;if(c!=null){e.$window.scrollTop(c)}};i.updateSelectedEvent=function(q){return g};l.menus[m]=i})});a(function(d,c){d.fn.renderMenus=function(){var f=this;var h=f.menus;var e=f.config.menus;var g=f.menuContainer;var j;var i=0;c.each(e,function(m,l){if(l==="|"){i++;return}j=h[l];if(j){j.render(i)}})}});a(function(d,c){d.fn.renderMenuContainer=function(){var e=this;var g=e.menuContainer;var f=e.$editorContainer;g.render()}});a(function(d,c){d.fn.renderTxt=function(){var f=this;var e=f.txt;e.render();f.ready(function(){e.initHeight()})}});a(function(d,c){d.fn.renderEditorContainer=function(){var h=this;var e=h.$valueContainer;var i=h.$editorContainer;var g=h.txt.$txt;var f,j;if(e===g){f=h.$prev;j=h.$parent;if(f&&f.length){f.after(i)}else{j.prepend(i)}}else{e.after(i);e.hide()}}});a(function(d,c){d.fn.eventMenus=function(){var e=this.menus;c.each(e,function(g,f){f.bindEvent()})}});a(function(d,c){d.fn.eventMenuContainer=function(){}});a(function(d,c){d.fn.eventTxt=function(){var e=this.txt;e.saveSelectionEvent();e.updateValueEvent();e.updateMenuStyleEvent()}});a(function(d,c){d.plugin(function(){var f=this;var e=f.config.uploadImgFns;e.onload||(e.onload=function(j,k){d.log("上传结束，返回结果为 "+j);var i=this;var h=i.uploadImgOriginalName||"";var g;if(j.indexOf("error|")===0){d.warn("上传失败："+j.split("|")[1]);alert(j.split("|")[1])}else{d.log("上传成功，即将插入编辑区域，结果为："+j);g=document.createElement("img");g.onload=function(){var l='<img src="'+j+'" alt="'+h+'" style="max-width:100%;"/>';i.command(null,"insertHtml",l);d.log("已插入图片，地址 "+j);g=null};g.onerror=function(){d.error("使用返回的结果获取图片，发生错误。请确认以下结果是否正确："+j);g=null};g.src=j}});e.ontimeout||(e.ontimeout=function(g){d.error("上传图片超时");alert("上传图片超时")});e.onerror||(e.onerror=function(g){d.error("上传上图片发生错误");alert("上传上图片发生错误")})})});a(function(d,c){if(!window.FileReader||!window.FormData){return}d.plugin(function(){var l=this;var g=l.config;var o=g.uploadImgUrl;var k=g.uploadTimeout;var m=g.uploadImgFns;var i=m.onload;var e=m.ontimeout;var n=m.onerror;if(!o){return}function j(q,t){var p=window.atob(q.split(",")[1]);var u=new ArrayBuffer(p.length);var r=new Uint8Array(u);var s;for(s=0;s<p.length;s++){r[s]=p.charCodeAt(s)}return new Blob([u],{type:t})}function h(r,q){var p=document.createElement("img");p.onload=function(){var s='<img src="'+r+'" style="max-width:100%;"/>';l.command(q,"insertHtml",s);d.log("已插入图片，地址 "+r);p=null};p.onerror=function(){d.error("使用返回的结果获取图片，发生错误。请确认以下结果是否正确："+r);p=null};p.src=r}function f(q){if(q.lengthComputable){var p=q.loaded/q.total;l.showUploadProgress(p*100)}}l.xhrUploadImg=function(s){var q=s.event;var x=s.filename||"";var z=s.base64;var F=s.fileType||"image/png";var r=s.name||"wangEditor_upload_file";var A=s.loadfn||i;var y=s.errorfn||n;var w=s.timeoutfn||e;var v=l.config.uploadParams||{};var t=l.config.uploadHeaders||{};var E="png";if(x.indexOf(".")>0){E=x.slice(x.lastIndexOf(".")-x.length+1)}else{if(F.indexOf("/")>0&&F.split("/")[1]){E=F.split("/")[1]}}if(d.isOnWebsite){d.log("预览模拟上传");h(z,q);return}var D=new XMLHttpRequest();var C;var p;var u=new FormData();function B(){if(C){clearTimeout(C)}if(D&&D.abort){D.abort()}q.preventDefault();w&&w.call(l,D);l.hideUploadProgress()}D.onload=function(){if(C){clearTimeout(C)}l.uploadImgOriginalName=x;if(x.indexOf(".")>0){l.uploadImgOriginalName=x.split(".")[0]}A&&A.call(l,D.responseText,D);l.hideUploadProgress()};D.onerror=function(){if(C){clearTimeout(C)}q.preventDefault();y&&y.call(l,D);l.hideUploadProgress()};D.upload.onprogress=f;u.append(r,j(z,F),d.random()+"."+E);c.each(v,function(G,H){u.append(G,H)});D.open("POST",o,true);c.each(t,function(G,H){D.setRequestHeader(G,H)});D.withCredentials=true;D.send(u);C=setTimeout(B,k);d.log("开始上传...并开始超时计算")}})});a(function(d,c){d.plugin(function(){var j=this;var i=j.menuContainer;var h=i.height();var m=j.$editorContainer;var f=m.width();var k=c('<div class="wangEditor-upload-progress"></div>');var l=false;function g(){if(l){return}l=true;k.css({top:h+"px"});m.append(k)}j.showUploadProgress=function(o){if(n){clearTimeout(n)}g();k.show();k.width(o*f/100)};var n;function e(){k.hide();n=null}j.hideUploadProgress=function(o){if(n){clearTimeout(n)}o=o||750;n=setTimeout(e,o)}})});a(function(d,c){d.plugin(function(){var j=this;var h=j.config;var f=h.uploadImgUrl;var g=h.uploadTimeout;var k;if(!f){return}var l=j.$uploadContent;if(!l){return}var i=c('<div class="upload-icon-container"><i class="wangeditor-menu-img-upload"></i></div>');l.append(i);var e=new d.UploadFile({editor:j,uploadUrl:f,timeout:g,fileAccept:"image/*"});i.click(function(m){k=m;e.selectFiles()})})});a(function(e,d){if(!window.FileReader||!window.FormData){return}var c=function(f){this.editor=f.editor;this.uploadUrl=f.uploadUrl;this.timeout=f.timeout;this.fileAccept=f.fileAccept;this.multiple=true};c.fn=c.prototype;c.fn.clear=function(){this.$input.val("");e.log("input value 已清空")};c.fn.render=function(){var g=this;if(g._hasRender){return}e.log("渲染dom");var j=g.fileAccept;var i=j?'accept="'+j+'"':"";var f=g.multiple;var h=f?'multiple="multiple"':"";var l=d('<input type="file" '+i+" "+h+"/>");var k=d('<div style="visibility:hidden;"></div>');k.append(l);e.$body.append(k);l.on("change",function(m){g.selected(m,l.get(0))});g.$input=l;g._hasRender=true};c.fn.selectFiles=function(){var f=this;e.log("使用 html5 方式上传");f.render();e.log("选择文件");f.$input.click()};c.fn.selected=function(i,g){var f=this;var h=g.files||[];if(h.length===0){return}e.log("选中 "+h.length+" 个文件");d.each(h,function(j,k){f.upload(k)})};c.fn.upload=function(h){var p=this;var l=p.editor;var g=h.name||"";var q=h.type||"";var m=l.config.uploadImgFns;var o=l.config.uploadImgFileName||"wangEditorH5File";var i=m.onload;var f=m.ontimeout;var n=m.onerror;var k=new FileReader();if(!i||!f||!n){e.error("请为编辑器配置上传图片的 onload ontimeout onerror 回调事件");return}e.log("开始执行 "+g+" 文件的上传");function j(){p.clear()}k.onload=function(s){e.log("已读取"+g+"文件");var r=s.target.result||this.result;l.xhrUploadImg({event:s,filename:g,base64:r,fileType:q,name:o,loadfn:function(u,v){j();var t=this;i.call(t,u,v)},errorfn:function(u){j();if(e.isOnWebsite){alert("wangEditor官网暂时没有服务端，因此报错。实际项目中不会发生")}var t=this;n.call(t,u)},timeoutfn:function(u){j();if(e.isOnWebsite){alert("wangEditor官网暂时没有服务端，因此超时。实际项目中不会发生")}var t=this;f(t,u)}})};k.readAsDataURL(h)};e.UploadFile=c});a(function(e,d){if(window.FileReader&&window.FormData){return}var c=function(f){this.editor=f.editor;this.uploadUrl=f.uploadUrl;this.timeout=f.timeout;this.fileAccept=f.fileAccept;this.multiple=false};c.fn=c.prototype;c.fn.clear=function(){this.$input.val("");e.log("input value 已清空")};c.fn.hideModal=function(){this.modal.hide()};c.fn.render=function(){var q=this;var f=q.editor;var m=f.config.uploadImgFileName||"wangEditorFormFile";if(q._hasRender){return}var k=q.uploadUrl;e.log("渲染dom");var h="iframe"+e.random();var p=d('<iframe name="'+h+'" id="'+h+'" frameborder="0" width="0" height="0"></iframe>');var s=q.multiple;var i=s?'multiple="multiple"':"";var g=d("<p>选择图片并上传</p>");var j=d('<input type="file" '+i+' name="'+m+'"/>');var l=d('<input type="submit" value="上传"/>');var r=d('<form enctype="multipart/form-data" method="post" action="'+k+'" target="'+h+'"></form>');var o=d('<div style="margin:10px 20px;"></div>');r.append(g).append(j).append(l);d.each(f.config.uploadParams,function(t,u){r.append(d('<input type="hidden" name="'+t+'" value="'+u+'"/>'))});o.append(r);o.append(p);q.$input=j;q.$iframe=p;var n=new e.Modal(f,undefined,{$content:o});q.modal=n;q._hasRender=true};c.fn.bindLoadEvent=function(){var f=this;if(f._hasBindLoad){return}var j=f.editor;var l=f.$iframe;var i=l.get(0);var h=i.contentWindow;var k=j.config.uploadImgFns.onload;function g(){var m=d.trim(h.document.body.innerHTML);if(!m){return}var o=f.$input.val();var n=o;if(o.lastIndexOf("\\")>=0){n=o.slice(o.lastIndexOf("\\")+1);if(n.indexOf(".")>0){n=n.split(".")[0]}}j.uploadImgOriginalName=n;k.call(j,m);f.clear();f.hideModal()}if(i.attachEvent){i.attachEvent("onload",g)}else{i.onload=g}f._hasBindLoad=true};c.fn.show=function(){var g=this;var h=g.modal;function f(){h.show();g.bindLoadEvent()}setTimeout(f)};c.fn.selectFiles=function(){var f=this;e.log("使用 form 方式上传");f.render();f.clear();f.show()};e.UploadFile=c});a(function(d,c){d.plugin(function(){var k=this;var j=k.txt;var e=j.$txt;var i=k.config;var l=i.uploadImgUrl;var m=i.uploadImgFileName||"wangEditorPasteFile";var f;var h;if(!l){return}function g(){var n=/^data:(image\/\w+);base64/;var o=e.find("img");d.log("粘贴后，检查到编辑器有"+o.length+"个图片。开始遍历图片，试图找到刚刚粘贴过来的图片");c.each(o,function(){var r=this;var s=c(r);var q;var p=s.attr("src");var t;h.each(function(){if(r===this){q=true;return false}});if(q){return}d.log("找到一个粘贴过来的图片");if(n.test(p)){d.log("src 是 base64 格式，可以上传");t=p.match(n)[1];k.xhrUploadImg({event:f,base64:p,fileType:t,name:m})}else{d.log("src 为 "+p+" ，不是 base64 格式，暂时不支持上传")}s.remove()});d.log("遍历结束")}e.on("paste",function(p){f=p;var o=f.clipboardData||f.originalEvent.clipboardData;var q;var n;if(o==null){q=window.clipboardData&&window.clipboardData.getData("text")}else{q=o.getData("text/plain")||o.getData("text/html")}if(q){return}n=o&&o.items;if(n){d.log("通过 data.items 得到了数据");c.each(n,function(u,v){var s=v.type||"";if(s.indexOf("image")<0){return}var t=v.getAsFile();var r=new FileReader();d.log("得到一个粘贴图片");r.onload=function(x){d.log("读取到粘贴的图片");var w=x.target.result||this.result;k.xhrUploadImg({event:f,base64:w,fileType:s,name:m})};r.readAsDataURL(t)})}else{d.log("未从 data.items 得到数据，使用检测粘贴图片的方式");h=e.find("img");d.log("粘贴前，检查到编辑器有"+h.length+"个图片");setTimeout(g,0)}})})});a(function(d,c){d.plugin(function(){var i=this;var f=i.txt;var g=f.$txt;var h=i.config;var e=h.uploadImgUrl;var j=h.uploadImgFileName||"wangEditorDragFile";if(!e){return}d.$document.on("dragleave drop dragenter dragover",function(k){k.preventDefault()});g.on("drop",function(m){m.preventDefault();var k=m.originalEvent;var l=k.dataTransfer&&k.dataTransfer.files;if(!l||!l.length){return}c.each(l,function(o,q){var r=q.type;var p=q.name;if(r.indexOf("image/")<0){return}d.log("得到图片 "+p);var n=new FileReader();n.onload=function(t){d.log("读取到图片 "+p);var s=t.target.result||this.result;i.xhrUploadImg({event:m,base64:s,fileType:r,name:j})};n.readAsDataURL(q)})})})});a(function(d,c){d.plugin(function(){var n=this;var j=n.txt;var e=j.$txt;var q=n.useMaxHeight?e.parent():e;var r;var s=false;var i=c('<div class="txt-toolbar"></div>');var h=c('<div class="tip-triangle"></div>');var m=c('<a href="#"><i class="wangeditor-menu-img-trash-o"></i></a>');var k=c('<a href="#"><i class="wangeditor-menu-img-search-minus"></i></a>');var g=c('<a href="#"><i class="wangeditor-menu-img-search-plus"></i></a>');function f(){if(s){return}o();i.append(h).append(m).append(k).append(g);n.$editorContainer.append(i);s=true}function o(){var t;function u(v,w){if(t){n.customCommand(v,t,w)}}m.click(function(v){t=function(){r.remove()};u(v,function(){setTimeout(l,100)})});g.click(function(v){t=function(){r.css({width:"100%"})};u(v,function(){setTimeout(p)})});k.click(function(v){t=function(){r.css({width:"auto"})};u(v,function(){setTimeout(p)})})}function p(){if(n._disabled){return}if(r==null){return}r.addClass("clicked");var B=r.position();var C=B.top;var D=B.left;var u=r.outerHeight();var y=r.outerWidth();var A=C+u;var v=D;var w=0;var z=q.position().top;var x=q.outerHeight();if(A>(z+x)){A=z+x}i.show();var t=i.outerWidth();w=y/2-t/2;i.css({top:A+5,left:v,"margin-left":w});if(w<0){i.css("margin-left","0");h.hide()}else{h.show()}}function l(){if(r==null){return}r.removeClass("clicked");r=null;i.hide()}q.on("click","table",function(u){var t=c(u.currentTarget);f();if(r&&(r.get(0)===t.get(0))){setTimeout(l,100);return}r=t;p();u.preventDefault();u.stopPropagation()}).on("click keydown scroll",function(t){setTimeout(l,100)});d.$body.on("click keydown scroll",function(t){setTimeout(l,100)})})});a(function(d,c){if(d.userAgent.indexOf("MSIE 8")>0){return}d.plugin(function(){var j=this;var K=j.config.lang;var q=j.txt;var C=q.$txt;var v=j.useMaxHeight?C.parent():C;var x=j.$editorContainer;var i;var y="";var u=false;var r=c('<div class="img-drag-point"></div>');var J=c('<div class="txt-toolbar"></div>');var e=c('<div class="tip-triangle"></div>');var A=c("<div></div>");var I=c('<a href="#"><i class="wangeditor-menu-img-trash-o"></i></a>');var f=c('<a href="#"><i class="wangeditor-menu-img-search-minus"></i></a>');var o=c('<a href="#"><i class="wangeditor-menu-img-search-plus"></i></a>');var E=c('<a href="#"><i class="wangeditor-menu-img-align-left"></i></a>');var s=c('<a href="#"><i class="wangeditor-menu-img-align-center"></i></a>');var g=c('<a href="#"><i class="wangeditor-menu-img-align-right"></i></a>');var p=c('<a href="#"><i class="wangeditor-menu-img-link"></i></a>');var H=c('<a href="#"><i class="wangeditor-menu-img-unlink"></i></a>');var D=c('<div style="display:none;"></div>');var l=c('<input type="text" style="height:26px; margin-left:10px; width:200px;"/>');var h=c('<button class="right">'+K.submit+"</button>");var w=c('<button class="right gray">'+K.cancel+"</button>");var G=false;function k(P,M){if(!i){return}var N;var R=function(){if(M!=null){y=M}};var L;var Q=false;var O=i.parent();if(O.get(0).nodeName.toLowerCase()==="a"){L=O;Q=true}else{L=c('<a target="_blank"></a>')}if(M==null){return L.attr("href")||""}else{if(M===""){if(Q){N=function(){i.unwrap()}}}else{if(M===y){return}N=function(){L.attr("href",M);if(!Q){i.wrap(L)}}}}if(N){j.customCommand(P,N,R)}}function F(){if(u){return}z();m();A.append(I).append(f).append(o).append(E).append(s).append(g).append(p).append(H);D.append(l).append(w).append(h);J.append(e).append(A).append(D);j.$editorContainer.append(J).append(r);u=true}function z(){var L;function M(N,O){if(L){j.customCommand(N,L,O)}}I.click(function(N){k(N,"");L=function(){i.remove()};M(N,function(){setTimeout(n,100)})});o.click(function(N){L=function(){var P=i.get(0);var Q=P.width;var O=P.height;Q=Q*1.1;O=O*1.1;i.css({width:Q+"px",height:O+"px"})};M(N,function(){setTimeout(B)})});f.click(function(N){L=function(){var P=i.get(0);var Q=P.width;var O=P.height;Q=Q*0.9;O=O*0.9;i.css({width:Q+"px",height:O+"px"})};M(N,function(){setTimeout(B)})});E.click(function(N){L=function(){i.parents("p").css({"text-align":"left"}).attr("align","left")};M(N,function(){setTimeout(n,100)})});g.click(function(N){L=function(){i.parents("p").css({"text-align":"right"}).attr("align","right")};M(N,function(){setTimeout(n,100)})});s.click(function(N){L=function(){i.parents("p").css({"text-align":"center"}).attr("align","center")};M(N,function(){setTimeout(n,100)})});p.click(function(N){N.preventDefault();y=k(N);l.val(y);A.hide();D.show()});h.click(function(O){O.preventDefault();var N=c.trim(l.val());if(N){k(O,N)}setTimeout(n)});w.click(function(N){N.preventDefault();l.val(y);A.show();D.hide()});H.click(function(N){N.preventDefault();k(N,"");setTimeout(n)})}function m(){var P,N;var O,R;var M,L;function Q(X){var U,T;U=X.pageX-P;T=X.pageY-N;var W=O+U;var V=R+T;r.css({"margin-left":W,"margin-top":V});var Y=M+U;var S=L+T;i&&i.css({width:Y,height:S})}r.on("mousedown",function(S){if(!i){return}P=S.pageX;N=S.pageY;O=parseFloat(r.css("margin-left"),10);R=parseFloat(r.css("margin-top"),10);M=i.width();L=i.height();J.hide();d.$document.on("mousemove._dragResizeImg",Q);d.$document.on("mouseup._dragResizeImg",function(T){d.$document.off("mousemove._dragResizeImg");d.$document.off("mouseup._dragResizeImg");n();r.css({"margin-left":O,"margin-top":R});G=false});G=true})}function B(){if(j._disabled){return}if(i==null){return}i.addClass("clicked");var V=i.position();var Q=V.top;var U=V.left;var T=i.outerHeight();var S=i.outerWidth();r.css({top:Q+T,left:U+S});var R=Q+T;var M=U;var N=0;var P=v.position().top;var O=v.outerHeight();if(R>(P+O)){R=P+O}else{r.show()}J.show();var L=J.outerWidth();N=S/2-L/2;J.css({top:R+5,left:M,"margin-left":N});if(N<0){J.css("margin-left","0");e.hide()}else{e.show()}j.disableMenusExcept()}function n(){if(i==null){return}i.removeClass("clicked");i=null;J.hide();r.hide();j.enableMenusExcept()}function t(M){var L=false;if(!j.emotionUrls){return L}c.each(j.emotionUrls,function(P,O){var N=false;if(M===O){L=true;N=true}if(N){return false}});return L}v.on("mousedown","img",function(L){L.preventDefault()}).on("click","img",function(M){var L=c(M.currentTarget);var N=L.attr("src");if(!N||t(N)){return}F();if(i&&(i.get(0)===L.get(0))){setTimeout(n,100);return}i=L;B();A.show();D.hide();M.preventDefault();M.stopPropagation()}).on("click keydown scroll",function(L){if(!G){setTimeout(n,100)}})})});a(function(d,c){d.plugin(function(){var o=this;var h=o.config.lang;var e=o.txt.$txt;var m;var j=c('<div class="txt-toolbar"></div>');var g=c('<div class="tip-triangle"></div>');var i=c('<a href="#" target="_blank"><i class="wangeditor-menu-img-link"></i> '+h.openLink+"</a>");var u;var l=false;var q,k;var p,t;function f(){if(u){return}j.append(g).append(i);o.$editorContainer.append(j);u=true}function s(){if(!m){return}var w=m.position();var A=w.left;var z=w.top;var v=m.height();var y=z+v+5;var B=o.menuContainer.height();var x=o.txt.$txt.outerHeight();if(y>B+x){y=B+x+5}j.css({top:y,left:A})}function r(){if(l){return}if(!m){return}f();j.show();var v=m.attr("href");i.attr("href",v);s();l=true}function n(){if(!l){return}if(!m){return}j.hide();l=false}e.on("mouseenter","a",function(v){if(q){clearTimeout(q)}q=setTimeout(function(){var w=v.currentTarget;var y=c(w);m=y;var x=y.children("img");if(x.length){x.click(function(z){n()});if(x.hasClass("clicked")){return}}r()},500)}).on("mouseleave","a",function(v){if(k){clearTimeout(k)}k=setTimeout(n,500)}).on("click keydown scroll",function(v){setTimeout(n,100)});j.on("mouseenter",function(v){if(k){clearTimeout(k)}}).on("mouseleave",function(v){if(p){clearTimeout(p)}p=setTimeout(n,500)})})});a(function(d,c){d.plugin(function(){var j=this;var n=j.config.menuFixed;if(n===false||typeof n!=="number"){return}var h=parseFloat(d.$body.css("margin-top"),10);if(isNaN(h)){h=0}var p=j.$editorContainer;var m=p.offset().top;var k=p.outerHeight();var f=j.menuContainer.$menuContainer;var l=f.css("position");var i=f.css("top");var o=f.offset().top;var g=f.outerHeight();var e=j.txt.$txt;d.$window.scroll(function(){if(j.isFullScreen){return}var q=d.$window.scrollTop();var r=f.width();if(o===0){o=f.offset().top;m=p.offset().top;k=p.outerHeight();g=f.outerHeight()}if(q>=o&&q+n+g+30<m+k){f.css({position:"fixed",top:n});f.width(r);d.$body.css({"margin-top":h+g});if(!j._isMenufixed){j._isMenufixed=true}}else{f.css({position:l,top:i});f.css("width","100%");d.$body.css({"margin-top":h});if(j._isMenufixed){j._isMenufixed=false}}})})});a(function(d,c){d.createMenu(function(e){var h="indent";if(!e(h)){return}var f=this;var g=new d.Menu({editor:f,id:h,title:"缩进",$domNormal:c('<a href="#" tabindex="-1"><i class="wangeditor-menu-img-indent-left"></i></a>'),$domSelected:c('<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-indent-left"></i></a>')});g.clickEvent=function(m){var k=f.getRangeElem();var l=f.getSelfOrParentByName(k,"p");var i;if(!l){return m.preventDefault()}i=c(l);function j(){i.css("text-indent","2em")}f.customCommand(m,j)};g.clickEventSelected=function(m){var k=f.getRangeElem();var l=f.getSelfOrParentByName(k,"p");var i;if(!l){return m.preventDefault()}i=c(l);function j(){i.css("text-indent","0")}f.customCommand(m,j)};g.updateSelectedEvent=function(){var k=f.getRangeElem();var l=f.getSelfOrParentByName(k,"p");var j;var i;if(!l){return false}j=c(l);i=j.css("text-indent");if(!i||i==="0px"){return false}return true};f.menus[h]=g})});a(function(d,c){d.createMenu(function(e){var j="lineheight";if(!e(j)){return}var g=this;g.commandHooks.lineHeight=function(l){var k=g.getRangeElem();var m=g.getSelfOrParentByName(k,"p,h1,h2,h3,h4,h5,pre");if(!m){return}c(m).css("line-height",l+"")};var i=new d.Menu({editor:g,id:j,title:"行高",commandName:"lineHeight",$domNormal:c('<a href="#" tabindex="-1"><i class="wangeditor-menu-img-arrows-v"></i></a>'),$domSelected:c('<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-arrows-v"></i></a>')});var h={"1.0":"1.0倍","1.5":"1.5倍","1.8":"1.8倍","2.0":"2.0倍","2.5":"2.5倍","3.0":"3.0倍"};var f='<span style="line-height:{#commandValue}">{#title}</span>';i.dropList=new d.DropList(g,i,{data:h,tpl:f});g.menus[j]=i})});a(function(d,c){d.plugin(function(){var h=this;var f=h.config.customUpload;if(!f){return}else{if(h.config.uploadImgUrl){alert("自定义上传无效，详看浏览器日志console.log");d.error("已经配置了 uploadImgUrl ，就不能再配置 customUpload ，两者冲突。将导致自定义上传无效。");return}}var i=h.$uploadContent;if(!i){d.error("自定义上传，无法获取 editor.$uploadContent")}var g=c('<div class="upload-icon-container"><i class="wangeditor-menu-img-upload"></i></div>');i.append(g);var j="upload"+d.random();var e="upload"+d.random();g.attr("id",j);i.attr("id",e);h.customUploadBtnId=j;h.customUploadContainerId=e})});a(function(d,c){d.info("本页面富文本编辑器由 wangEditor 提供 http://wangeditor.github.io/ ")});return window.wangEditor});